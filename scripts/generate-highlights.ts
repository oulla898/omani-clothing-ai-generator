import { GoogleGenAI } from '@google/genai'
import mime from 'mime'
import { promises as fs } from 'fs'
import path from 'path'

interface HighlightDefinition {
  key: string
  title: string
  copy: string
  heroDirection: string
  notes?: string
  screenshotPath?: string
}

interface InlineReference {
  inlineData: {
    mimeType: string
    data: string
  }
}

const MODEL_NAME = 'gemini-3-pro-image-preview'
const OUTPUT_DIR = path.resolve(__dirname, 'highlight-outputs')
const PROJECT_ROOT = path.resolve(__dirname, '..', '..')

const BRAND_REFERENCE_PATH = path.resolve(
  PROJECT_ROOT,
  'Brand Assets & Application Showcase (2).png'
)
const LOGO_PATH = path.resolve(PROJECT_ROOT, 'logo.png')

const SCREENSHOT_HOW_TO_PATH = path.resolve(
  'C:/Users/oulla/OneDrive/Pictures/Screenshots/Screenshot 2025-12-06 180004.png'
)

const HIGHLIGHTS: HighlightDefinition[] = [
  {
    key: 'why-haiba',
    title: 'ููุด ููุจุฉุ',
    heroDirection:
      'ุงุณุชุฎุฏู ุฃุดูุงูุงู ููุฏุณูุฉ ูุณุชูุญุงุฉ ูู ุงููููุด ุงูุนูุงููุฉุ ูุดุฑุงุฆุท ูู ุงูููุงุด ุงููุฎูููุ ูุฎุทูุท ุฐูุจูุฉ ูุชููุฌุฉ ุจุฏูู ุฃู ุฃุดุฎุงุต. ุงุฌุนู ุงูุชูููู ูุจุฏู ูุฃูู ูุนุจุฏ ูู ุงูุถูุก ูุงููููุด ูุฑูุฒ ููุฅุจุฏุงุน ูู ุงููุจุณ ุงูุนูุงูู.',
    copy:
      'ููุด ููุจุฉุ\n\nููุจุฉ ููุตุฉ ุนูุงููุฉ ุชุฑุณู ูู ุตูุฑ ุฃุฒูุงุก ุนูุงููุฉ ุจุงูุฐูุงุก ุงูุงุตุทูุงุนู.\nุชุฑูุฒ ุนูู ุงูุฏุดุฏุงุดุฉุ ุงูููุตุฑุ ุงููุตุฑ ุงูุนูุงููุ ุงูุฎูุฌุฑุ ุงูุนุจุงุกุฉโฆ ููู ุชูุงุตูู ุงููุจุณ ุงูุนูุงูู.\nุจุฏู ูุง ุชุฏูุฑ ููุฏูู ููุตูุฑ ูููุงูุ ุชูุชุจ ููุฑุชู ูุงูุตูุฑุฉ ุชุทูุน ูู ุฌุงูุฒุฉ.',
    notes: 'ุญุงูุธ ุนูู ุชุตููู ุชุฌุฑูุฏู ุจุงููุงูู ุจุฏูู ุฃุดุฎุงุต ูุงุณุชููู ูู ุฎุงูุงุช ุงูุญุฑูุฑุ ุงููุญุงุณุ ูุงูุฑูู.'
  },
  {
    key: 'how-to-use',
    title: 'ููู ุฃุณุชุนูููุ',
    heroDirection:
      'ุงุฏูุฌ ููุทุฉ ุงูุดุงุดุฉ ุงููุฑููุฉ ุฏุงุฎู ุฅุทุงุฑ ุฐูุจู ูุธูู ูู ููุชุตู ุงูุชุตูููุ ูุฃุถู ุณูุงูุงู ุฑููุนุฉ ูุนูุงููู ูุตูุฑุฉ ุชุดุฑุญ ูู ุฎุทูุฉ ุญูููุงุ ูุน ุฎูููุฉ ูุชุฏุฑุฌุฉ ูู ุงููููู ุฅูู ุงูุจุฑุบูุฏู ูุฒุฎุงุฑู ุฐูุจูุฉ ุฎูููุฉ.',
    copy:
      'ููู ุฃุณุชุนูููุ\n\nุชุฏุฎู ุนูู ูููุน: haiba.store\nุชุณูู ุญุณุงุจ ุจุจุณุงุทุฉ ุนู ุทุฑูู ุฌูุฌูุ ูุชุญุตู ุฑุตูุฏ ูุฌุงูู ููุชุฌุฑุจุฉ ุฃูู ูุง ุชุณุฌู.\nุชูุชุจ ูุตู ุงูููุฑุฉ ุจุงูุนุฑุจู: ูู ุงูุดุฎุตุ ูุงุจุณ ููุดุ ููู ุงูููุงูุ\nุชุถุบุท ุชูููุฏุ ูุจุนุฏูุง ุชุญููู ุงูุตูุฑ ุงููู ุชุนุฌุจู.',
    notes:
      'ุฃุถู ูุตุงู ุตุบูุฑุงู ุจุฌุงูุจ ูู ุณูู ูุดุฑุญ ุงูุฎุทูุงุช ุงูุฃุฑุจุนุฉุ ูุงุณุชุฎุฏู ุฃููููุงุช ุจุณูุทุฉ (ูุชุตูุญุ ุญุณุงุจุ ูุชุงุจุฉุ ุชุญููู).',
    screenshotPath: SCREENSHOT_HOW_TO_PATH
  },
  {
    key: 'how-to-find',
    title: 'ููู ุชููุงูุงุ',
    heroDirection:
      'ุชุตููู ุจุณูุท ููุธูู ุฌุฏุงู: ุดุฑูุท ุจุญุซ ุฃุจูุถ ูุณุทุญ ูู ููุชุตู ุงูุดุงุดุฉ ุจุฏูู ุฃู ุชุฃุซูุฑุงุช ูุงูุนุฉ. ุฎูููุฉ ุจููู ุฑูุงุฏู ุฏุงูู ููุญุฏ (#1a1a1a). ูุง ุฒุฎุงุฑูุ ูุง ุชุฏุฑุฌุงุช ูุนูุฏุฉุ ูุง ุฅุถุงุกุฉ ุฐูุจูุฉ. ููุท ุดุฑูุท ุจุญุซ ูุธูู ููุชูุจ ููู ุงููุต ุงูุนุฑุจู. ุชุญุชู ูุณุงูุฉ ูุงุฑุบุฉ ุซู ุงููุต.',
    copy:
      'ุงุจุญุซ ูู ุฌูุฌู:\n\n"ูููุฏ ุงูุงุฒูุงุก ุงูุนูุงููุฉ"\n\nุฃู ุฒูุฑ haiba.store',
    notes:
      'ุชุตููู ูููููุงูู ุฌุฏุงู. ุดุฑูุท ุจุญุซ ุฃุจูุถ ุจุณูุท ุจุฏูู ุธูุงู ูููุฉ. ุฎุท ุนุฑุจู ูุธูู ููุงุถุญ. ูุง ุชุถู ุฃุณูู ุฃู ุฃููููุงุช ุฅุถุงููุฉ. ุงููุณุงุญุฉ ุงูุจูุถุงุก ูููุฉ. ุงูุฎูููุฉ ุฏุงููุฉ ููุงุฏุฆุฉ ุจุฏูู ุฃู ุฒุฎุงุฑู.'
  },
  {
    key: 'credits',
    title: 'ุงูุฑุตูุฏ',
    heroDirection:
      'ุตููู ูุฎุทุท ุชุฏููู ุฐูุจู ุจุฃุฑุจุนุฉ ูุฑุงุญู ูุชุตูุฉ ุจุณูู ุฏุงุฆุฑูุฉ ุญูู ุฏุงุฆุฑุฉ ูุฑูุฒูุฉุ ูุน ุฃููููุงุช ูุตุบุฑุฉ ุชูุซู ุชุณุฌููุ ุงูุชูุงุตูุ ุงูุงุชูุงูุ ูุงูุชุฒููุฏ ุงูููุฑูุ ููููุง ููู ุฎูููุฉ ููุณูุฌุฉ ุจุงููููู ูุงูุจุฑุบูุฏู.',
    copy:
      'ุงูุฑุตูุฏ\n\nุฃูู ูุง ุชุณุฌูุ ููุตูู ุฑุตูุฏ ูุฌุงูู ููุชุฌุฑุจุฉ.\nููุง ุชุญุจ ุชุฒูุฏุ ุงุถุบุท ุงูุฑุตูุฏ > ุชูุงุตู ุนูู ูุงุชุณุงุจ > ุงุชูู ูุนูุง > ูุฒููุฏ ุญุณุงุจู ููุฑ ุชุฃููุฏ ุงูุชุญููู.\nุฃุณุนุงุฑูุง ุชุจุฏุฃ ูู 100 ุจูุณุฉ ููุท. ููุจู ุงูุฏูุน ุจุงูุชุญููู ุจุฑูู ุงููุงุชู ุจุจุณุงุทุฉ.',
    notes: 'ุฃุธูุฑ ุงูุฃุณูู ุงููุชุชุงุจุนุฉ ุจุดูู ูุงุถุญ ูุงุฐูุฑ ุฑูู ุงููุงุชู 77310987 ุฏุงุฎู ุดุงุฑุฉ ุตุบูุฑุฉ ุนูุฏ ูุฑุญูุฉ ุงูุชุญููู.'
  },
  {
    key: 'team',
    title: 'ูุฑูููุง ุนูุงูู',
    heroDirection:
      'ูููู ููุญุฉ ูุฌุฑุฏุฉ ุชุฑูุฒ ููุฑู ุนูุงููุฉ ุจุงุณุชุฎุฏุงู ุฎุทูุท ูุนูุงุฑูุฉ ูุชุดุงุจูุฉ ูุฃุดูุงู ุชุดุจู ุงููุตุฑ ุงูุนูุงูู ูุงูุฏุดุฏุงุดุฉุ ูุน ุชููุฌ ุฐูุจู ููุญู ุจุงููุฎุฑ ูุงูุงูุชูุงุก ุจุฏูู ุฅุธูุงุฑ ุฃุดุฎุงุต.',
    copy:
      'ูุฑูููุง ุนูุงูู\n\nููุจุฉ ูุจูู ุจุฃูุงุฏู ูููุฏุณูู ููุทูุฑูู ุนูุงูููู.\nููุชู ุฅู ุงููุจุณ ุงูุนูุงูู ูุทูุน ูุฎูุ ูุฑุชุจุ ููุฑูุน ุงูุฑุงุณ.\nูุฏููุง ูุฑูุน ูู ุญุถูุฑ ุงูุฃุฒูุงุก ุงูุนูุงููุฉ ูู ุงูุนุงูู ุงูุฑููู.',
    notes: 'ุฃุถู ุนุจุงุฑุฉ ุตุบูุฑุฉ โุตูุน ุจุฃูุงุฏู ุนูุงููุฉโ ุจุงููุฑุจ ูู ุงูุนููุงู ุฏุงุฎู ุดุงุฑุฉ ุฒุฎุฑููุฉ.'
  },
  {
    key: 'creators',
    title: 'ูููุตูููู ูุตููุงุน ุงููุญุชูู',
    heroDirection:
      'ุตููู ุจุทุงูุงุช ุดุจููุฉ ูููุง ุฃููููุงุช ุจุตุฑูุฉ ููุจูุณุชุงุช ูุงููุตุต ูุงูุฅุนูุงูุงุชุ ูุฑุจูุทุฉ ุจุฎุทูุท ุฐูุจูุฉ ุชุฎุฑุฌ ูู ูุฑูุฒ ูุฑูุฒ ุฅูู ููุตุฉ ููุจุฉุ ูุน ุทุจูุงุช ูุฑููุฉ ูุงุฎุฑุฉ.',
    copy:
      'ูููุตูููู ูุตููุงุน ุงููุญุชูู\n\nูู ุนูุฏู ุญุณุงุจ ุฅูุณุชุบุฑุงู ุฃู ูุดุฑูุน ุตุบูุฑ ูุชุญุชุงุฌ ุตูุฑ ุฃุฒูุงุก ุนูุงููุฉุ ููุจุฉ ูุณุงุนุฏู ุชุทูุน ุฃููุงุฑ ูุตูุฑ ุจุณุฑุนุฉ.\nุชูุฏุฑ ุชุณุชุฎุฏู ุงูุตูุฑ ูู ุงูุจูุณุชุงุชุ ุงููุตุตุ ุงูุฅุนูุงูุงุชุ ูุงูุนุฑูุถ.\nููุชุงุฒ ููู ูุดุชุบููุง ุนูู ุจุฑุงูุฏุงุช ุนูุงููุฉ ุฃู ูุญุชูู ุนู ุงูุชุฑุงุซ.',
    notes: 'ุงุณุชุฎุฏู ุฑููุฒ ุตุบูุฑุฉ (ูุตุฉุ ุจูุณุชุ ุฅุนูุงู) ุจุฌุงูุจ ุงูุฎุทูุทุ ูุงุฌุนู ุงููุต ููุฒุนุงู ุนูู ุซูุงุซ ุจุทุงูุงุช.'
  },
  {
    key: 'enterprise',
    title: 'ููุดุฑูุงุช ูุงููุคุณุณุงุช',
    heroDirection:
      'ุงุจูู ููุญุฉ ุชุธูุฑ ุฑุตูุฏ ูุดุชุฑู ุฏุงุฎู ุฎุฒูุฉ ุฐูุจูุฉ ุฑูุฒูุฉ ูุน ุฎุทูุท ูุชุฌูุฉ ูุนุฏุฉ ูุฑูุ ูุถุน ุจุทุงูุงุช ุชูุงุตู ูููุง ุฃููููุฉ ูุงุชุณุงุจ ูุฃููููุฉ ุจุฑูุฏ ุจุฌุงูุจ ุฑูู ุงููุงุชู ูุงูุฅูููู.',
    copy:
      'ููุดุฑูุงุช ูุงููุคุณุณุงุช\n\nูุฌูุฒ ููู ุฑุตูุฏ ูุจุงูุงุช ุชูุงุณุจ ุงููุฑูู ุฃู ุญููุชูู.\nุงูุชูุงุตู ูููู ุนุจุฑ ุงูุงูููู ุฃู ุงููุงุชุณุงุจุ ููุฑุชุจ ููู ุดูุก ููุงุณุจ ุงุญุชูุงุฌูู.\n+968 77310 987    haiba.auth@gmail.com',
    notes: 'ุฃุถู ุญููู ูุตูุฉ ูุงุถุญุฉ ูุฑูู ุงููุงุชู ูุงูุฅูููู ุฏุงุฎู ุฅุทุงุฑ ูุนุฏูู ุฃููู.'
  },
  {
    key: 'ai-limits',
    title: 'ุญุฏูุฏ ุงูุฐูุงุก ุงูุงุตุทูุงุนู',
    heroDirection:
      'ุงุจูู ูุดูุฏ ุถูุฆู ูุชูููู ูู ููุฌุฉ ุถุจุงุจูุฉ ุฐูุจูุฉ ุชุชูุงุดู ุชุฏุฑูุฌูุงู ูุชุชุฑู ุฎูููุง ูุณูุฑุงู ุจุณูุทุฉ ูู ุงูููุงุดุ ูุน ุฅุดุงุฑุงุช ุชุญุฐูุฑ ุตุบูุฑุฉ ุชููุน ุญูููุงุ ุจุฏูู ุฃู ุฑูุฒ .',
    copy:
      'ุญุฏูุฏ ุงูุฐูุงุก ุงูุงุตุทูุงุนู\n\nูููุง ุงุดุชุบููุง ุนูู ุชุญุณูู ุงููููุฐุฌุ ุงูุฐูุงุก ุงูุงุตุทูุงุนู ุฏุงุฆูุงู ููู ูุณุจุฉ ุฎุทุฃ.\nุฃุญูุงูุงู ูุทูุน ุดูุก ุบุฑูุจ ูู ุงูุตูุฑุฉุ ุฃู ุชูุตููุฉ ูุง ุชููู ูุซู ูุง ุชุฎููุชูุง ุจุงูุถุจุท.\nุฏูุฑูุง ูููู ุงูุฃุฎุทุงุก ููุทููุฑ ุงูุชุฌุฑุจุฉุ ููู ูุง ููุฏุฑ ูุถูู ุฅู ูู ุตูุฑุฉ ุชุทูุน ูุซุงููุฉ ูู ุฃูู ูุญุงููุฉ.',
    notes:
      'ุฃุถู ุดุฑูุทุงู ุชุญุฐูุฑูุงู ุตุบูุฑุงู ุฃุณูู ุงูุจุทุงูุฉ ูุฐูุฑ: โุฌุฑุจ ุฃูุซุฑ ูู ูุฑุฉ ูุงุฎุชุฑ ุงููุชูุฌุฉ ุงููู ุชูุงุณุจูโุ ูุงุณุชุฎุฏู ุฃููููุฉ ุชูุจูู ูุฌุฑุฏุฉ ุจุฏูุงู ูู ุงู.'
  },
  {
    key: 'community',
    title: 'ูุณูุน ูููู',
    heroDirection:
      'ุตููู ููุญุฉ ุจุซูุงุซ ุฅุทุงุฑุงุช ุตูุฑ ูุงุฑุบุฉ ุจุฅุถุงุกุฉ ุฐูุจูุฉ ุชูุญู ุจุงุฎุชูุงุฑ ุฃุนูุงู ุงููุฌุชูุนุ ูุน ุณูู ูุฏุนู ุงููุงุณ ูููุดุงุฑูุฉ ูุนูุงูุฉ ูุงุชุณุงุจ ุตุบูุฑุฉ.',
    copy:
      'ูุณูุน ูููู\n\nูุญุจ ูุดูู ุงูุตูุฑ ุงููู ุชุทูุน ููู ูู ููุจุฉ.\nูู ุนุฌุจุชู ูุชูุฌุฉ ูุชุญุจ ูุนุฑุถูุงุ ุดุงุฑููุง ูุนูุง.\nูุฎุชุงุฑ ุงูุฃุนูุงู ุงููููุฒุฉ ูููุดุฑูุง.',
    notes: 'ุถุน ุนุจุงุฑุฉ โุฃุฑุณููุง ููุง ูู ุงููุงุชุณุงุจโ ุจุฌุงูุจ ุงูุฃููููุฉ ูุฑุจุท ุงูููุฑุฉ.'
  },
  {
    key: 'contact',
    title: 'ุงููููุน ูุงูุชูุงุตู',
    heroDirection:
      'ุงุตูุน ุจุทุงูุฉ ูุนูููุงุช ูุงุฎุฑุฉ ูููุง ูุณู ููุฑุงุจุท ููุณู ููุณุงุฆู ุงูุชูุงุตูุ ูุน ุฎุทูุท ุฐูุจูุฉ ุชุฑุจุท ูู ุนูุตุฑ ูุชุฃููุฏ ุจุตุฑู ุนูู ุนููุงู haiba.store.',
    copy:
      'ุงููููุน ูุงูุชูุงุตู\n\nูููุน ููุจุฉ: haiba.store\nุฃู ุงุณุชูุณุงุฑ ุนู ุงูุงุณุชุฎุฏุงู ุฃู ุงูุฑุตูุฏ ุฃู ุงูุฃููุงุฑโฆ ุฑุงุณููุง ุนูู ุงููุงุชุณุงุจ 77310987\nุงูุงูููู: haiba.auth@gmail.com\nููุฑุฃ ููุงุญุธุงุชูู ูุงูุชุฑุงุญุงุชููุ ููุจูู ุงูููุตุฉ ุฎุทูุฉ ุจุฎุทูุฉ ูุนูู.',
    notes: 'ุงุณุชุฎุฏู ุฃุฒุฑุงุฑุงู ุจูุถุงููุฉ ุตุบูุฑุฉ ููู ููุงุฉ ุชูุงุตูุ ูุถุน ุงูุฑุงุจุท ุงูุฑุฆูุณู ูู ุฃุนูู ุงูุจุทุงูุฉ ุจุฎุท ุฃูุจุฑ.'
  }
]

function buildPrompt(highlight: HighlightDefinition): string {
  const palette = `
- Deep Omani Indigo #2C3E50
- Warm Burgundy #8B4513
- Rich Gold #D4AF37
- Warm Cream #F5E6D3
- Earthy Taupe #A89968
- Deep Charcoal #3E3E3E
- Warm Terracotta #BC744E
- Soft Sage #92A892`

  return `ุตููู ุจุทุงูุฉ ูุตุฉ ุฅูุณุชุบุฑุงู ุนููุฏูุฉ ุจูุณุจุฉ 9:16 ุชูุซู ูุงููุงูุช "${highlight.title}" ูุจุฑุงูุฏ ููุจุฉ.

ุงููุฏู:
- ุฅุจุฑุงุฒ ุฃู ููุจุฉ ุฃูุถู ููุตุฉ ุนูุงููุฉ ูุงุจุชูุงุฑ ุตูุฑ ุงููุจุณ ุงูุนูุงูู ุจุงูุฐูุงุก ุงูุงุตุทูุงุนู.
- ุงูุญูุงุธ ุนูู ูููุฉ ูุงุฎุฑุฉุ ูุธููุฉุ ูุน ููุณุฉ ุฐูุจูุฉ ููุง ูู ุธุงูุฑ ูู ุตูุฑุฉ ุงููุฑุฌุน ุงููุฑููุฉ.
- ุงุณุชุฎุฏู ููุท ููุญุฉ ุงูุฃููุงู ุงูุฑุณููุฉ ุงูุชุงููุฉ:
${palette}

ุงูุชุนูููุงุช ุงูุจุตุฑูุฉ:
1. ุงุนุชูุฏ ุงูุตูุฑุฉ ุงููุฑุฌุนูุฉ ุงููุฑููุฉ (Brand Assets & Application Showcase) ููุตุฏุฑ ููุฃููุงูุ ุงูุชุฏุฑุฌุงุชุ ูุงููููุณ ุงูุฐูุจูุ ูุงุฏูุฌ ุงูุฃููุงุท ุงููุฒุฎุฑูุฉ ุงูููุฌูุฏุฉ ูููุง.
2. ุงูุชุฒู ุญุฑููุงู ุจููุญุฉ ุงูุฃููุงู ุงููุญุฏุฏุฉ ุฃุนูุงูุ ูุง ุชุณุชุฎุฏู ุฃู ุฃููุงู ุฎุงุฑุฌูุง.
3. ูุง ุชุฑุณู ุฃู ุดุฎุตูุงุช ุฃู ูุฌูู ุฃู ููุฏููุงุชุ ุงุณุชุฎุฏู ุฎุงูุงุช ูุฃุดูุงูุงู ูุฌุฑุฏุฉ ููุท.
4. ุถุน ุดุนุงุฑ ููุจุฉ ุงูุฃุจูุถ ูู ููู ุงูุดุนุงุฑ ูู ุฃุณูู ุงูุจุทุงูุฉ ุจูุญุงุฐุงุฉ ุงููุณุท ูุน ุชููุฌ ูุทูู.
5. ุฃูุดุฆ ููุฑู ุบูู ุจุงูุฎุงูุงุช ุงููุชูุฃูุฆุฉ: ${highlight.heroDirection}
6. ุงูููุงุญุธุงุช ุงูุฎุงุตุฉ ููุฐู ุงูุจุทุงูุฉ: ${highlight.notes ?? 'ุญุงูุธ ุนูู ููุณ ุงูุฃุณููุจ ุงููุณุชุฎุฏู ูู ุจุงูู ุงููุงููุงูุช.'}
7. ุงุฌุนู ุงููุต ุงูุชุงูู ูุธูุฑ ููุง ููุ ุจููุณ ุงูุชุฑุชูุจ ูุงูุฎุทูุท ุงูุนุฑุจูุฉ ุงูุนุตุฑูุฉ.

ุงููุต ุงููุทููุจ (ุงุณุชุฎุฏูู ููุง ูู ูุน ููุงุตู ุงูุฃุณุทุฑ):
"""
${highlight.copy}
"""

ุงูุชุฎุทูุท:
- ุงูุนููุงู ูุจูุฑ ููุงุถุญ ูู ุงูุฃุนููุ ูุจุงูู ุงููุต ููุฒูุน ูู ูุชู ูุตูุฑุฉ ูุชุจุงุนุฏุฉ.
- ุงุชุฑู ููุงุก ุจุตุฑู ุญูู ุงููุตุ ูุน ุญูุงู ุฏุงุฎููุฉ ูุฑูุญุฉ.
- ุญุงูุธ ุนูู ุงุชุณุงู ุฌููุน ุงููุงููุงูุช ุงููุงุฏูุฉ ูุน ูุฐุง ุงูุฃุณููุจ.

ุชูุงุตูู ุฅุถุงููุฉ:
- ุงูุฅุถุงุกุฉ ุฏุงูุฆุฉุ ุงูุธูุงู ูุงุนูุฉุ ูุงูุญุจูุจุงุช ุงูุณูููุงุฆูุฉ ุฎูููุฉ.
- ุฌูุฏุฉ ุนุงููุฉ ุฌุฏุงูุ ุฌุงูุฒุฉ ููุทุจุงุนุฉ ุฃู ุงููุดุฑ.
- ูุง ุชุถู ุฃู ูุต ุฅุถุงูู ุฃู ุฃู ุดุนุงุฑ ุขุฎุฑ.`
}

async function loadInlineReference(filePath: string): Promise<InlineReference> {
  const buffer = await fs.readFile(filePath)
  const mimeType = mime.getType(filePath) || 'application/octet-stream'
  return {
    inlineData: {
      mimeType,
      data: buffer.toString('base64')
    }
  }
}

async function ensureOutputDir(): Promise<void> {
  await fs.mkdir(OUTPUT_DIR, { recursive: true })
}

async function generateHighlight(
  highlight: HighlightDefinition,
  brandReference: InlineReference,
  logoReference: InlineReference,
  extraReferences: InlineReference[] = []
): Promise<void> {
  const ai = new GoogleGenAI({ apiKey: process.env.GEMINI_API_KEY })
  const prompt = buildPrompt(highlight)

  const response = await ai.models.generateContentStream({
    model: MODEL_NAME,
    config: {
      responseModalities: ['IMAGE', 'TEXT'],
      imageConfig: {
        aspectRatio: '9:16',
        imageSize: '1K'
      }
    },
    contents: [
      {
        role: 'user',
        parts: [
          {
            text: 'ุงุณุชุฎุฏู ุงููุฑููุงุช ุงูุชุงููุฉ ููุฑุฌุน ุจุตุฑู: ุงูุตูุฑุฉ ุงูุฃููู ูููููุฉุ ุงูุซุงููุฉ ุดุนุงุฑ ุฃุจูุถ ููุถุน ูู ุงูุฃุณููุ ูุฃู ูููุงุช ุฅุถุงููุฉ ูุฌุจ ุฏูุฌูุง ุชุตููููุงู ูุน ุฃุณูู ูุดุฑุญ ูุงุถุญ.'
          },
          brandReference,
          logoReference,
          ...extraReferences
        ]
      },
      {
        role: 'user',
        parts: [{ text: prompt }]
      }
    ]
  })

  let imageIndex = 0
  for await (const chunk of response) {
    const part = chunk.candidates?.[0]?.content?.parts?.[0]
    if (part?.inlineData) {
      const extension = mime.getExtension(part.inlineData.mimeType || '') || 'png'
      const outputPath = path.join(
        OUTPUT_DIR,
        `${highlight.key}-${Date.now()}-${imageIndex}.${extension}`
      )
      const imageData = part.inlineData.data ?? ''
      await fs.writeFile(outputPath, Buffer.from(imageData, 'base64'))
      console.log(`โ Saved ${outputPath}`)
      imageIndex++
    } else if (chunk.text) {
      console.log('โน๏ธ Model note:', chunk.text)
    }
  }
}

async function main() {
  if (!process.env.GEMINI_API_KEY) {
    throw new Error('GEMINI_API_KEY is not set. Please add it to your environment.')
  }

  await ensureOutputDir()

  const brandReference = await loadInlineReference(BRAND_REFERENCE_PATH)
  const logoReference = await loadInlineReference(LOGO_PATH)

  const activeHighlights = HIGHLIGHTS.filter(h => h.key === 'how-to-find')

  for (const highlight of activeHighlights) {
    console.log(`๐ฏ Generating highlight: ${highlight.title}`)
    const extras: InlineReference[] = []
    if (highlight.screenshotPath) {
      try {
        extras.push(await loadInlineReference(highlight.screenshotPath))
      } catch (err) {
        console.warn(`โ๏ธ ูู ูุชููู ูู ูุฑุงุกุฉ ููุทุฉ ุงูุดุงุดุฉ ุงูุฎุงุตุฉ ุจู ${highlight.title}:`, err)
      }
    }
    await generateHighlight(highlight, brandReference, logoReference, extras)
  }
}

main().catch(err => {
  console.error('โ Highlight generation failed:', err)
  process.exit(1)
})
