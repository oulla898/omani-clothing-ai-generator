<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>هيبة | مولد الأزياء العمانية بالذكاء الاصطناعي</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="مولد الذكاء الاصطناعي للأزياء العمانية التقليدية. اصنع صور أصيلة للدشداشة والبشت والخنجر. Traditional Omani clothing AI generator for authentic dishdasha, bisht, and khanjar designs.">
    <meta name="keywords" content="عمان, أزياء عمانية, دشداشة, بشت, خنجر, ذكاء اصطناعي, Oman, Omani clothing, dishdasha, bisht, khanjar, AI generator, traditional clothing">
    <meta name="author" content="Heiba - هيبة">
    <meta name="robots" content="index, follow">
    <meta name="google-site-verification" content="LzFtldRRazokRREi3lINHaf1aB4GkBikKFaPzi2hvZ4" />
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="هيبة - مولد الأزياء العمانية بالذكاء الاصطناعي">
    <meta property="og:description" content="اصنع صور أصيلة للأزياء العمانية التقليدية بالذكاء الاصطناعي">
    <meta property="og:url" content="https://omani-clothing-ai-generator.vercel.app">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://omani-clothing-ai-generator.vercel.app/logo.png">
    <meta property="og:site_name" content="Heiba - هيبة">
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="هيبة - Omani Clothing AI Generator">
    <meta name="twitter:description" content="Generate authentic Omani traditional clothing with AI">
    <meta name="twitter:image" content="https://omani-clothing-ai-generator.vercel.app/logo.png">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://omani-clothing-ai-generator.vercel.app">
    
    <!-- Favicon -->
    <link rel="icon" href="/logo.png" type="image/png"
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Clerk Authentication -->
    <script async crossorigin="anonymous" data-clerk-publishable-key="pk_test_bWVhc3VyZWQtY2hvdy01Ny5jbGVyay5hY2NvdW50cy5kZXYk" src="https://wise-parakeet-29.clerk.accounts.dev/npm/@clerk/clerk-js@latest/dist/clerk.browser.js" type="text/javascript"></script>
    
    <style>
        .font-arabic { font-family: 'Noto Sans Arabic', 'Arial Unicode MS', sans-serif; }
        .font-english { font-family: 'Inter', 'Segoe UI', sans-serif; }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        .sample-image {
            aspect-ratio: 1;
            object-fit: cover;
            border-radius: 16px;
            transition: all 0.3s ease;
        }
        
        .sample-image:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .floating-action {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 50;
        }
        
        .history-modal {
            display: none;
        }
        
        .history-modal.active {
            display: flex;
        }
        
        .refined-prompt {
            display: none;
            animation: slideDown 0.3s ease;
        }
        
        .refined-prompt.show {
            display: block;
        }
        
        .low-credits-glow {
            animation: gentle-glow 2s ease-in-out infinite alternate;
            border: 2px solid rgba(255, 165, 0, 0.6);
        }
        
        @keyframes gentle-glow {
            from { 
                box-shadow: 0 0 5px rgba(255, 165, 0, 0.5);
                background-color: rgba(255, 165, 0, 0.1);
            }
            to { 
                box-shadow: 0 0 15px rgba(255, 165, 0, 0.8);
                background-color: rgba(255, 165, 0, 0.2);
            }
        }
        
        .credit-package {
            transition: all 0.3s ease;
        }
        
        .credit-package:hover {
            transform: translateY(-2px);
        }
        
        .credits-display:hover {
            transform: scale(1.05);
        }
        
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .generation-status {
            display: none;
        }
        
        .generation-status.active {
            display: block;
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100 font-english">

    <!-- Top Section - Generation Area -->
    <div class="min-h-screen flex flex-col">
        
        <!-- Header -->
        <header class="glass-effect sticky top-0 z-40 px-4 py-3">
            <div class="flex items-center justify-between max-w-7xl mx-auto">
                <!-- Logo -->
                <div class="flex items-center">
                    <img src="logo.png" alt="Logo" class="w-10 h-10 rounded-full">
                </div>
                
                <!-- Account Area -->
                <div class="flex items-center space-x-4 space-x-reverse">
                    <!-- Language Toggle -->
                    <button id="languageToggle" class="px-3 py-2 rounded-full text-sm font-medium bg-white/20 hover:bg-white/30 transition-colors">
                        <span id="languageText">English</span>
                    </button>
                    
                    <!-- Credits Display -->
                    <div id="creditsDisplay" class="hidden px-3 py-2 bg-green-100 rounded-full cursor-pointer hover:bg-green-200 transition-all credits-display" onclick="showCreditModal()">
                        <span class="text-sm font-medium text-green-800">
                            <span data-en="Credits:" data-ar="الرصيد:">الرصيد:</span>
                            <span id="creditsCount">0</span>
                            <span class="ml-1">💳</span>
                        </span>
                    </div>
                    
                    <!-- Auth Button -->
                    <button id="authButton" class="px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-full text-sm font-medium transition-colors">
                        <span data-en="Sign In" data-ar="تسجيل الدخول">تسجيل الدخول</span>
                    </button>
                </div>
            </div>
        </header>

        <!-- Main Generation Section -->
        <main class="flex-1 flex items-center justify-center px-4 py-8">
            <div class="w-full max-w-2xl">
                
                <!-- Hero Text -->
                <div class="text-center mb-8">
                    <h1 class="text-4xl md:text-6xl font-bold text-gray-900 mb-4">
                        <span data-en="Create Traditional" data-ar="أنشئ أزياء">أنشئ أزياء</span><br>
                        <span class="gradient-bg bg-clip-text text-transparent" data-en="Omani Fashion" data-ar="عمانية تراثية">عمانية تراثية</span>
                    </h1>
                    <div class="flex justify-center mb-4">
                        <span class="text-sm bg-orange-100 text-orange-600 px-3 py-1 rounded-full font-medium" data-en="Experimental" data-ar="تجريبي">تجريبي</span>
                    </div>
                    <p class="text-xl text-gray-600 mb-6" data-en="AI that perfects the Misar fold, Bisht elegance, and Khanjar shine" data-ar="ذكاء اصطناعي عماني يضبط لفة المِصر وهيبة البشت">ذكاء اصطناعي عماني يضبط لفة المِصر وهيبة البشت ولمعة الخنجر</p>
                </div>

                <!-- Generation Form -->
                <div class="bg-white/80 backdrop-blur-md rounded-3xl p-6 md:p-8 shadow-xl border border-white/20">
                    
                    <!-- Description Input -->
                    <div class="mb-6">
                        <div class="flex items-center justify-between mb-3">
                            <label class="block text-sm font-medium text-gray-700" data-en="Describe your vision:" data-ar="صف رؤيتك:">صف رؤيتك:</label>
                            <button 
                                id="suggestionButton" 
                                onclick="showSuggestionPopup()" 
                                class="text-xs bg-gradient-to-r from-amber-500 to-orange-600 text-white px-3 py-1 rounded-full hover:from-amber-600 hover:to-orange-700 transition-all transform hover:scale-105 shadow-sm">
                                <span data-en="💡 Suggestion" data-ar="💡 اقتراح">💡 اقتراح</span>
                            </button>
                        </div>
                        <textarea 
                            id="description" 
                            rows="4" 
                            class="w-full px-4 py-3 border border-gray-300 rounded-2xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 resize-none"
                            data-placeholder-en="Describe the traditional Omani clothing you want to create..."
                            data-placeholder-ar="صف الأزياء العمانية التراثية التي تريد إنشاءها..."
                            placeholder="صف الأزياء العمانية التراثية التي تريد إنشاءها..."></textarea>
                    </div>

                    <!-- Advanced Options (Collapsible) -->
                    <div class="mb-6">
                        <button 
                            id="toggleAdvancedOptions" 
                            onclick="toggleAdvancedOptions()" 
                            class="flex items-center justify-between w-full px-4 py-3 bg-gray-50 hover:bg-gray-100 rounded-xl transition-colors text-left">
                            <div class="flex items-center gap-2">
                                <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"/>
                                </svg>
                                <span class="text-sm font-medium text-gray-700" data-en="Advanced Options" data-ar="خيارات متقدمة">خيارات متقدمة</span>
                            </div>
                            <svg id="advancedOptionsChevron" class="w-4 h-4 text-gray-500 transition-transform transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                            </svg>
                        </button>
                        
                        <!-- Collapsible Options Panel -->
                        <div id="advancedOptionsPanel" class="hidden mt-3 p-4 bg-gray-50 rounded-xl border border-gray-200 space-y-4">
                            
                            <!-- Speed vs Quality Toggle -->
                            <div class="space-y-2">
                                <label class="block text-xs font-medium text-gray-600" data-en="Generation Speed" data-ar="سرعة التوليد">سرعة التوليد</label>
                                <div class="grid grid-cols-2 gap-2">
                                    <button 
                                        id="qualityMode" 
                                        onclick="setGenerationMode('quality')" 
                                        class="px-3 py-2 bg-white border-2 border-indigo-500 text-indigo-600 rounded-lg text-xs font-medium transition-all hover:bg-indigo-50 flex items-center justify-center gap-1">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"/>
                                        </svg>
                                        <span data-en="Quality" data-ar="جودة عالية">جودة عالية</span>
                                    </button>
                                    <button 
                                        id="fastMode" 
                                        onclick="setGenerationMode('fast')" 
                                        class="px-3 py-2 bg-gray-100 border-2 border-gray-200 text-gray-600 rounded-lg text-xs font-medium transition-all hover:bg-gray-200 flex items-center justify-center gap-1">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                                        </svg>
                                        <span data-en="Fast" data-ar="سريع">سريع</span>
                                        <span class="text-[10px] opacity-60" data-en="(lower quality)" data-ar="(جودة أقل)">(جودة أقل)</span>
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Aspect Ratio -->
                            <div class="space-y-2">
                                <label class="block text-xs font-medium text-gray-600" data-en="Image Aspect Ratio" data-ar="نسبة أبعاد الصورة">نسبة أبعاد الصورة</label>
                                <div class="grid grid-cols-5 gap-2">
                                    <button 
                                        onclick="setAspectRatio('1:1')" 
                                        class="aspect-ratio-btn px-2 py-2 bg-white border-2 border-indigo-500 text-indigo-600 rounded-lg text-xs font-medium transition-all hover:bg-indigo-50 flex flex-col items-center justify-center gap-1">
                                        <div class="w-5 h-5 border-2 border-current rounded-sm"></div>
                                        <span>1:1</span>
                                    </button>
                                    <button 
                                        onclick="setAspectRatio('16:9')" 
                                        class="aspect-ratio-btn px-2 py-2 bg-gray-100 border-2 border-gray-200 text-gray-600 rounded-lg text-xs font-medium transition-all hover:bg-gray-200 flex flex-col items-center justify-center gap-1">
                                        <div class="w-6 h-3 border-2 border-current rounded-sm"></div>
                                        <span>16:9</span>
                                    </button>
                                    <button 
                                        onclick="setAspectRatio('9:16')" 
                                        class="aspect-ratio-btn px-2 py-2 bg-gray-100 border-2 border-gray-200 text-gray-600 rounded-lg text-xs font-medium transition-all hover:bg-gray-200 flex flex-col items-center justify-center gap-1">
                                        <div class="w-3 h-6 border-2 border-current rounded-sm"></div>
                                        <span>9:16</span>
                                    </button>
                                    <button 
                                        onclick="setAspectRatio('4:3')" 
                                        class="aspect-ratio-btn px-2 py-2 bg-gray-100 border-2 border-gray-200 text-gray-600 rounded-lg text-xs font-medium transition-all hover:bg-gray-200 flex flex-col items-center justify-center gap-1">
                                        <div class="w-5 h-4 border-2 border-current rounded-sm"></div>
                                        <span>4:3</span>
                                    </button>
                                    <button 
                                        onclick="setAspectRatio('custom')" 
                                        class="aspect-ratio-btn px-2 py-2 bg-gray-100 border-2 border-gray-200 text-gray-600 rounded-lg text-xs font-medium transition-all hover:bg-gray-200 flex flex-col items-center justify-center gap-1">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg>
                                        <span data-en="Custom" data-ar="مخصص">مخصص</span>
                                    </button>
                                </div>
                                <div id="customAspectInputs" class="mt-2 hidden flex gap-2 items-center">
                                    <input type="number" id="customWidth" min="128" max="2048" value="512" class="w-20 px-2 py-1 border border-gray-300 rounded text-xs" placeholder="Width">
                                    <span class="text-xs">x</span>
                                    <input type="number" id="customHeight" min="128" max="2048" value="512" class="w-20 px-2 py-1 border border-gray-300 rounded text-xs" placeholder="Height">
                                    <button onclick="applyCustomAspect()" class="px-2 py-1 bg-indigo-500 text-white rounded text-xs">OK</button>
                                </div>
                            </div>
                            
                            <!-- Output Format -->
                            <div class="space-y-2">
                                <label class="block text-xs font-medium text-gray-600" data-en="Output Format" data-ar="صيغة الإخراج">صيغة الإخراج</label>
                                <div class="grid grid-cols-3 gap-2">
                                    <button 
                                        onclick="setOutputFormat('webp')" 
                                        class="output-format-btn px-3 py-2 bg-white border-2 border-indigo-500 text-indigo-600 rounded-lg text-xs font-medium transition-all hover:bg-indigo-50 flex items-center justify-center gap-1">
                                        <span class="font-mono">WEBP</span>
                                        <span class="text-[10px] opacity-60" data-en="Best" data-ar="أفضل">أفضل</span>
                                    </button>
                                    <button 
                                        onclick="setOutputFormat('png')" 
                                        class="output-format-btn px-3 py-2 bg-gray-100 border-2 border-gray-200 text-gray-600 rounded-lg text-xs font-medium transition-all hover:bg-gray-200">
                                        <span class="font-mono">PNG</span>
                                    </button>
                                    <button 
                                        onclick="setOutputFormat('jpg')" 
                                        class="output-format-btn px-3 py-2 bg-gray-100 border-2 border-gray-200 text-gray-600 rounded-lg text-xs font-medium transition-all hover:bg-gray-200">
                                        <span class="font-mono">JPG</span>
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Info Note -->
                            <div class="flex items-start gap-2 p-2 bg-blue-50 border border-blue-200 rounded-lg">
                                <svg class="w-4 h-4 text-blue-600 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                                <p class="text-[10px] text-blue-700 leading-relaxed" data-en="Fast Mode uses fewer inference steps for quicker results but may reduce quality. WEBP offers best compression with high quality." data-ar="الوضع السريع يستخدم خطوات أقل لنتائج أسرع لكن قد تقل الجودة. WEBP يوفر أفضل ضغط مع جودة عالية.">الوضع السريع يستخدم خطوات أقل (14 بدلاً من 28) لنتائج أسرع لكن قد تقل الجودة. WEBP يوفر أفضل ضغط مع جودة عالية.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Generate Button -->
                    <button id="generateButton" class="w-full py-4 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white font-semibold rounded-2xl transition-all transform hover:scale-[1.02] active:scale-[0.98] shadow-lg">
                        <span data-en="✨ Generate Traditional Clothing" data-ar="✨ أنشئ الأزياء التراثية">✨ أنشئ الأزياء التراثية</span>
                    </button>

                    <!-- Refined Prompt Display (Initially Hidden) -->
                    <div id="refinedPrompt" class="refined-prompt mt-4 p-4 bg-blue-50 rounded-xl border border-blue-200">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-sm font-medium text-blue-800" data-en="🤖 AI Enhanced Prompt:" data-ar="🤖 الوصف المحسن بالذكاء الاصطناعي:">🤖 الوصف المحسن بالذكاء الاصطناعي:</span>
                            <button id="hideRefinedPrompt" class="text-blue-600 hover:text-blue-800 text-xs">✕</button>
                        </div>
                        <p id="refinedPromptText" class="text-sm text-blue-700"></p>
                    </div>

                    <!-- Generation Status -->
                    <div id="generationStatus" class="generation-status mt-4 p-4 bg-amber-50 rounded-xl border border-amber-200 text-center">
                        <div class="animate-spin w-6 h-6 border-2 border-amber-600 border-t-transparent rounded-full mx-auto mb-2"></div>
                        <p class="text-sm text-amber-700" data-en="Creating your traditional Omani clothing..." data-ar="جارٍ إنشاء أزياءك العمانية التراثية...">جارٍ إنشاء أزياءك العمانية التراثية...</p>
                    </div>

                    <!-- Generated Image Display -->
                    <div id="imageResult" class="mt-6 hidden">
                        <div class="relative">
                            <img id="generatedImage" src="" alt="Generated Image" class="w-full rounded-2xl shadow-lg">
                            <button id="downloadImage" class="absolute top-4 right-4 p-2 bg-white/90 hover:bg-white rounded-full shadow-lg transition-colors">
                                <svg class="w-5 h-5 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Sample Images Preview -->
                <div class="mt-8 text-center">
                    <button id="viewSamplesButton" class="text-indigo-600 hover:text-indigo-800 font-medium" data-en="👇 View Sample Creations" data-ar="👇 شاهد النماذج">👇 شاهد النماذج</button>
                </div>
            </div>
        </main>
    </div>

    <!-- Sample Images Section -->
    <section id="samplesSection" class="py-16 px-4 bg-white">
        <div class="max-w-6xl mx-auto">
            <h2 class="text-3xl md:text-4xl font-bold text-center mb-12 text-gray-800" data-en="Sample Traditional Creations" data-ar="نماذج من الإبداعات التراثية">نماذج من الإبداعات التراثية</h2>
            
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-6">
                <div class="card-hover">
                    <img src="رجل لابس مصر وبشت.jpg" alt="رجل لابس مصر وبشت" class="sample-image w-full">
                    <p class="text-center mt-2 text-sm text-gray-600" data-en="Traditional Misar & Bisht" data-ar="مصر وبشت تراثي">مصر وبشت تراثي</p>
                </div>
                
                <div class="card-hover">
                    <img src="طفل لابس مصر وبشت.jpg" alt="طفل لابس مصر وبشت" class="sample-image w-full">
                    <p class="text-center mt-2 text-sm text-gray-600" data-en="Child in Traditional Wear" data-ar="طفل بالزي التراثي">طفل بالزي التراثي</p>
                </div>
                
                <div class="card-hover">
                    <img src="عائلة رحال لابس مصر وبشت والللطفل لابس بس مصر.jpg" alt="عائلة تراثية" class="sample-image w-full">
                    <p class="text-center mt-2 text-sm text-gray-600" data-en="Traditional Family" data-ar="عائلة تراثية">عائلة تراثية</p>
                </div>
                
                <div class="card-hover">
                    <img src="معرس بشت وخنجر.jpg" alt="معرس بشت وخنجر" class="sample-image w-full">
                    <p class="text-center mt-2 text-sm text-gray-600" data-en="Groom with Bisht & Khanjar" data-ar="معرس ببشت وخنجر">معرس ببشت وخنجر</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Features Section -->
    <section class="py-16 px-4 bg-gray-50">
        <div class="max-w-6xl mx-auto">
            <h2 class="text-3xl md:text-4xl font-bold mb-12 text-gray-800 text-center" data-en="Carefully Designed Features" data-ar="مزايا صُمِّمت بعناية">مزايا صُمِّمت بعناية</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                <div class="bg-white p-8 rounded-2xl shadow-lg card-hover">
                    <div class="text-4xl mb-4">🎨</div>
                    <h3 class="text-xl font-semibold mb-4 text-gray-800" data-en="Authentic Details" data-ar="تفاصيل أصيلة">تفاصيل أصيلة</h3>
                    <p class="text-gray-600 leading-relaxed" data-en="Model fine-tuned for traditional Omani clothing with attention to patterns, colors, and Omani features." data-ar="النموذج صنع للأزياء العُمانية الرجالية مع اهتمام بالنقوش والألوان والملامح العمانية.">النموذج صنع للأزياء العُمانية الرجالية مع اهتمام بالنقوش والألوان والملامح العمانية.</p>
                </div>
                
                <div class="bg-white p-8 rounded-2xl shadow-lg card-hover">
                    <div class="text-4xl mb-4">🇴🇲</div>
                    <h3 class="text-xl font-semibold mb-4 text-gray-800" data-en="Made in Oman" data-ar="تراثنا في أيدٍ أمينة">تراثنا في أيدٍ أمينة</h3>
                    <p class="text-gray-600 leading-relaxed" data-en="Developed by an Omani team passionate about preserving the beauty of our traditional attire with cutting-edge technology" data-ar="فريق عُماني يعمل بشغف للحفاظ على رونق لبسنا وتطويره بأحدث التقنيات">فريق عُماني يعمل بشغف للحفاظ على رونق لبسنا وتطويره بأحدث التقنيات</p>
                </div>
                
                <div class="bg-white p-8 rounded-2xl shadow-lg card-hover">
                    <div class="text-4xl mb-4">⏱️</div>
                    <h3 class="text-xl font-semibold mb-4 text-gray-800" data-en="Fast & Reliable" data-ar="سريع وموثوق">سريع وموثوق</h3>
                    <p class="text-gray-600 leading-relaxed" data-en="Most results are completed within seconds to under a minute, depending on service load." data-ar="غالبية النتائج تُنجز خلال ثوانٍ إلى أقل من دقيقة، بحسب الضغط على الخدمة.">غالبية النتائج تُنجز خلال ثوانٍ إلى أقل من دقيقة، بحسب الضغط على الخدمة.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Floating History Button -->
    <button id="historyButton" class="floating-action bg-indigo-600 hover:bg-indigo-700 text-white p-4 rounded-full shadow-lg transition-all transform hover:scale-110">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
        </svg>
    </button>

    <!-- History Modal -->
    <div id="historyModal" class="history-modal fixed inset-0 bg-black/50 backdrop-blur-sm z-50 items-center justify-center p-4">
        <div class="bg-white rounded-3xl max-w-4xl w-full max-h-[80vh] overflow-hidden">
            <div class="p-6 border-b border-gray-200">
                <div class="flex items-center justify-between mb-3">
                    <h3 class="text-xl font-bold text-gray-800" data-en="Your Creation History" data-ar="تاريخ إبداعاتك">تاريخ إبداعاتك</h3>
                    <button id="closeHistoryModal" class="text-gray-500 hover:text-gray-700">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                </div>
                
                <!-- Safety Warning -->
                <div class="bg-amber-50 border border-amber-200 rounded-xl p-3 text-center">
                    <div class="flex items-center justify-center gap-2 text-amber-700">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                        <span class="text-xs font-medium" data-en="⚠️ Images are automatically deleted after 1 hour for security" data-ar="⚠️ تُحذف الصور تلقائياً بعد ساعة واحدة للأمان">⚠️ تُحذف الصور تلقائياً بعد ساعة واحدة للأمان</span>
                    </div>
                </div>
            </div>
            <div class="p-6 overflow-y-auto max-h-[60vh]">
                <div id="historyGrid" class="grid grid-cols-2 md:grid-cols-3 gap-4">
                    <!-- History items will be populated here -->
                    <div class="text-center text-gray-500 col-span-full py-8" data-en="No generations yet. Create your first traditional clothing!" data-ar="لا توجد إبداعات بعد. أنشئ أول أزياءك التراثية!">لا توجد إبداعات بعد. أنشئ أول أزياءك التراثية!</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Developer Section - Small Link -->
    <div class="py-6 px-4 bg-gray-50">
        <div class="max-w-6xl mx-auto text-center">
            <button onclick="showDeveloperInfo()" class="text-sm text-gray-600 hover:text-indigo-600 transition-colors cursor-pointer flex items-center justify-center gap-2 mx-auto">
                <span>👨‍💻</span>
                <span data-en="About the Developer" data-ar="عن المطور">عن المطور</span>
                <span class="text-xs">→</span>
            </button>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-900 text-white py-8 px-4">
        <div class="max-w-6xl mx-auto text-center">
            <p class="text-sm opacity-80">© 2025 هيبة — صُنع بحب لتراثنا</p>
        </div>
    </footer>

    <!-- Message Display -->
    <div id="messageContainer" class="fixed top-20 right-4 z-50"></div>

    <!-- Soft Notification Popup -->
    <div id="aiMessagePlaceholder" class="hidden fixed bottom-20 left-4 right-4 bg-white/90 backdrop-blur-md border border-blue-200 rounded-2xl p-4 z-40 shadow-xl">
    </div>



    <!-- Developer Info Modal -->
    <div id="developerModal" class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-3xl max-w-md w-full p-6 transform transition-all">
            <div class="flex justify-between items-start mb-4">
                <h3 class="text-xl font-bold flex items-center gap-2">
                    <span>👨‍💻</span>
                    <span data-en="About the Developer" data-ar="عن المطور">عن المطور</span>
                </h3>
                <button onclick="hideDeveloperInfo()" class="text-gray-400 hover:text-gray-600 transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <div class="space-y-4 text-sm" id="developerContent">
                <!-- Arabic Content -->
                <div class="ar-content">
                    <p class="leading-relaxed flex items-start gap-2">
                        <span>🎓</span>
                        <span>صُنع بحب من طالب في جامعة السلطان قابوس - المعولي</span>
                    </p>
                    <p class="leading-relaxed flex items-start gap-2">
                        <span>🤖</span>
                        <span>هذا النموذج تجريبي أولي، نعرف حدوده وأخطاءه، لكن نحن في رحلة تطوير مستمرة!</span>
                    </p>
                    <p class="leading-relaxed flex items-start gap-2">
                        <span>🚀</span>
                        <span>المزيد من التحديثات والتحسينات قادمة... ترقبوا!</span>
                    </p>
                    <p class="text-xs opacity-75 flex items-start gap-2 mt-4 p-3 bg-gray-50 rounded-xl">
                        <span>📧</span>
                        <span>للملاحظات والاقتراحات: <a href="mailto:oulla898@gmail.com" class="text-indigo-600 hover:underline">oulla898@gmail.com</a></span>
                    </p>
                </div>
                
                <!-- English Content (hidden by default) -->
                <div class="en-content hidden">
                    <p class="leading-relaxed flex items-start gap-2">
                        <span>🎓</span>
                        <span>Crafted with passion by an SQU student - Al Maawali</span>
                    </p>
                    <p class="leading-relaxed flex items-start gap-2">
                        <span>🤖</span>
                        <span>This is our first experimental model. We know its quirks and limitations, but we're on an exciting journey of continuous improvement!</span>
                    </p>
                    <p class="leading-relaxed flex items-start gap-2">
                        <span>🚀</span>
                        <span>More updates and enhancements coming soon... stay tuned!</span>
                    </p>
                    <p class="text-xs opacity-75 flex items-start gap-2 mt-4 p-3 bg-gray-50 rounded-xl">
                        <span>📧</span>
                        <span>Feedback & suggestions: <a href="mailto:oulla898@gmail.com" class="text-indigo-600 hover:underline">oulla898@gmail.com</a></span>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Prompt Suggestion Modal -->
    <div id="suggestionModal" class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4">
        <div class="bg-white/95 backdrop-blur-sm rounded-3xl p-6 max-w-lg w-full shadow-2xl transform transition-all">
            <div class="text-center mb-4">
                <h3 class="text-xl font-bold text-gray-800 mb-2">
                    <span data-en="💡 Suggested Prompt" data-ar="💡 اقتراح ملهم">💡 اقتراح ملهم</span>
                </h3>
                <p class="text-gray-600 text-sm">
                    <span data-en="Try this dramatic warrior prompt" data-ar="جرب هذا الاقتراح الملحمي">جرب هذا الاقتراح الملحمي</span>
                </p>
            </div>
            
            <!-- Warrior Prompt -->
            <div class="bg-gradient-to-br from-amber-50 to-orange-100 border-2 border-amber-300 rounded-2xl p-4 mb-4">
                <div class="text-sm text-amber-800 font-medium mb-2">
                    <span data-en="🗡️ Omani Warrior" data-ar="🗡️ محارب عُماني">🗡️ محارب عُماني</span>
                </div>
                <p class="text-amber-900 leading-relaxed font-arabic" id="warriorPromptText">
                    محارب عُماني يحمل ندوب المعارك، ملطخ بالتراب والعرق، يلوّح بالأسلحة العُمانية التقليدية في مشهد درامي مليء بالحركة، تتناثر فيه الشرر والدخان، مع إضاءة ملحمية.
                </p>
            </div>
            
            <div class="flex gap-3">
                <button 
                    onclick="useSuggestedPrompt()" 
                    class="flex-1 py-3 bg-gradient-to-r from-amber-600 to-orange-600 text-white rounded-xl font-medium hover:from-amber-700 hover:to-orange-700 transition-all transform hover:scale-105">
                    <span data-en="✨ Use This Prompt" data-ar="✨ استخدم هذا الاقتراح">✨ استخدم هذا الاقتراح</span>
                </button>
                <button 
                    onclick="closeSuggestionModal()" 
                    class="px-4 py-3 text-gray-600 hover:text-gray-800 transition-colors">
                    <span data-en="Cancel" data-ar="إلغاء">إلغاء</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Credit Purchase Modal -->
    <div id="creditPurchaseModal" class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4">
        <div class="bg-white/95 backdrop-blur-sm rounded-3xl p-6 max-w-md w-full shadow-2xl transform transition-all max-h-[90vh] overflow-hidden">
            <!-- Swipeable Container -->
            <div id="modalContainer" class="relative transition-transform duration-300 ease-out" style="transform: translateX(0);">
                
                <!-- Page 1: Credit Packages -->
                <div id="page1" class="w-full">
                    <div class="text-center mb-4">
                        <h3 class="text-xl font-bold text-gray-800 mb-1">
                            <span data-en="Add Credits 💳" data-ar="شراء رصيد 💳">شراء رصيد 💳</span>
                        </h3>
                        <p class="text-gray-600 text-xs">
                            <span data-en="Choose your credit package" data-ar="اختر باقة الرصيد المناسبة">اختر باقة الرصيد المناسبة</span>
                        </p>
                    </div>
            
            <!-- Credit Packages -->
            <div class="space-y-2 mb-4">
                <button onclick="buyCredits(20, 2)" class="credit-package w-full p-3 rounded-lg border-2 border-gray-200 hover:border-blue-400 transition-all flex justify-between items-center hover:shadow-md">
                    <div class="text-left">
                        <div class="font-semibold text-sm">💫 20 Credits</div>
                        <div class="text-xs text-gray-600" data-en="20 generations" data-ar="٢٠ تصميم">٢٠ تصميم</div>
                    </div>
                    <div class="text-right">
                        <div class="font-bold text-blue-600">2 <span data-en="OMR" data-ar="ريال">ريال</span></div>
                    </div>
                </button>
                
                <button onclick="buyCredits(50, 4)" class="credit-package popular w-full p-3 rounded-lg border-2 border-orange-400 bg-orange-50 transition-all flex justify-between items-center hover:shadow-md relative">
                    <div class="absolute -top-1 -right-1 bg-orange-500 text-white text-xs px-1 py-0.5 rounded-full">
                        <span data-en="Best Value" data-ar="أفضل قيمة">أفضل قيمة</span>
                    </div>
                    <div class="text-left">
                        <div class="font-semibold text-sm">🔥 50 Credits</div>
                        <div class="text-xs text-gray-600" data-en="50 generations" data-ar="٥٠ تصميم">٥٠ تصميم</div>
                    </div>
                    <div class="text-right">
                        <div class="font-bold text-orange-600">4 <span data-en="OMR" data-ar="ريال">ريال</span></div>
                        <div class="text-xs text-orange-600" data-en="25% bonus!" data-ar="٢٥٪ مكافأة!">٢٥٪ مكافأة!</div>
                    </div>
                </button>
                
                <button onclick="buyCredits(120, 10)" class="credit-package w-full p-3 rounded-lg border-2 border-gray-200 hover:border-green-400 transition-all flex justify-between items-center hover:shadow-md">
                    <div class="text-left">
                        <div class="font-semibold text-sm">⭐ 120 Credits</div>
                        <div class="text-xs text-gray-600" data-en="120 generations" data-ar="١٢٠ تصميم">١٢٠ تصميم</div>
                    </div>
                    <div class="text-right">
                        <div class="font-bold text-green-600">10 <span data-en="OMR" data-ar="ريال">ريال</span></div>
                        <div class="text-xs text-green-600" data-en="Maximum savings" data-ar="أقصى توفير">أقصى توفير</div>
                    </div>
                </button>
                
                <!-- Custom Amount -->
                <div class="custom-amount border-2 border-dashed border-gray-300 rounded-lg p-3 bg-gray-50">
                    <div class="text-center mb-2">
                        <div class="text-sm font-medium text-gray-700" data-en="💡 Custom Amount" data-ar="💡 مبلغ مخصص">💡 مبلغ مخصص</div>
                        <div class="text-xs text-gray-500" data-en="Minimum 0.5 OMR = 5 credits" data-ar="أقل مبلغ 0.5 ريال = 5 أرصدة">أقل مبلغ 0.5 ريال = 5 أرصدة</div>
                    </div>
                    <div class="flex gap-2 items-center">
                        <input 
                            type="number" 
                            id="customAmount" 
                            placeholder="5" 
                            min="0.5" 
                            max="100" 
                            step="0.5"
                            class="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm text-center focus:border-blue-400 focus:outline-none focus:ring-1 focus:ring-blue-200"
                        >
                        <span class="text-sm text-gray-600 font-medium" data-en="OMR" data-ar="ريال">ريال</span>
                        <button onclick="buyCreditsCustom()" class="px-4 py-2 bg-gradient-to-r from-blue-600 to-purple-600 text-white text-sm font-medium rounded-lg hover:from-blue-700 hover:to-purple-700 transition-all transform hover:scale-105">
                            <span data-en="Buy" data-ar="شراء">شراء</span>
                        </button>
                    </div>
                    <div class="text-xs text-gray-500 mt-2 text-center">
                        <span data-en="1 OMR = 10 credits" data-ar="1 ريال = 10 أرصدة">1 ريال = 10 أرصدة</span>
                    </div>
                </div>
            </div>
            
            <!-- Safety Information -->
            <div class="text-center text-xs text-gray-600 mb-3 p-2 bg-green-50 rounded-lg border border-green-200">
                <span data-en="💡 Safe & Easy - Credits added within 24 hours" data-ar="💡 آمن وسهل - يضاف الرصيد خلال ٢٤ ساعة">💡 آمن وسهل - يضاف الرصيد خلال ٢٤ ساعة</span>
            </div>
            
                    <div class="flex gap-2">
                        <button onclick="closeCreditModal()" class="flex-1 py-2 text-gray-600 hover:text-gray-800 transition-colors text-sm">
                            <span data-en="Maybe Later" data-ar="ربما لاحقاً">ربما لاحقاً</span>
                        </button>
                        <button onclick="closeCreditModal()" class="text-gray-400 hover:text-gray-600 transition-colors p-1">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                
                <!-- Page 2: WhatsApp Instructions -->
                <div id="page2" class="w-full absolute top-0 left-full px-6">
                    <div class="text-center mb-4">
                        <div class="text-3xl mb-2">🎉</div>
                        <h3 class="text-xl font-bold text-gray-800 mb-1">
                            <span data-en="Almost Done!" data-ar="أوشكت على الانتهاء!">أوشكت على الانتهاء!</span>
                        </h3>
                        <p class="text-gray-600 text-sm">
                            <span data-en="Contact us on WhatsApp to complete" data-ar="تواصل معنا على واتساب لإتمام الشراء">تواصل معنا على واتساب لإتمام الشراء</span>
                        </p>
                    </div>
                    
                    <!-- Selected Package Info -->
                    <div class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl p-4 mb-4 border border-blue-200">
                        <div class="flex justify-between items-center">
                            <div>
                                <div class="text-sm text-gray-600" data-en="Package:" data-ar="الباقة:">الباقة:</div>
                                <div class="text-xl font-bold text-blue-600" id="selectedCredits">50 Credits</div>
                            </div>
                            <div class="text-right">
                                <div class="text-sm text-gray-600" data-en="Price:" data-ar="السعر:">السعر:</div>
                                <div class="text-xl font-bold text-purple-600" id="selectedPrice">4 <span data-en="OMR" data-ar="ريال">ريال</span></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- User ID (Copyable) -->
                    <div class="bg-white rounded-xl p-3 mb-4 border-2 border-dashed border-gray-300">
                        <div class="text-xs text-gray-600 mb-1" data-en="Your User ID (share with us):" data-ar="معرف المستخدم (شاركه معنا):">معرف المستخدم (شاركه معنا):</div>
                        <div class="flex items-center gap-2">
                            <input type="text" id="userIdDisplay" readonly class="flex-1 text-sm font-mono bg-gray-50 px-2 py-1 rounded border border-gray-200" value="Loading...">
                            <button onclick="copyUserId()" class="px-3 py-1 bg-blue-500 text-white text-xs rounded hover:bg-blue-600 transition-colors">
                                <span data-en="Copy" data-ar="نسخ">نسخ</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Instructions -->
                    <div class="space-y-2 mb-4">
                        <div class="flex items-start gap-2">
                            <div class="w-6 h-6 bg-blue-500 text-white rounded-full flex items-center justify-center text-xs font-bold flex-shrink-0">1</div>
                            <div class="text-sm text-gray-700">
                                <span data-en="Click 'Open WhatsApp' below" data-ar="اضغط 'فتح واتساب' بالأسفل">اضغط 'فتح واتساب' بالأسفل</span>
                            </div>
                        </div>
                        <div class="flex items-start gap-2">
                            <div class="w-6 h-6 bg-blue-500 text-white rounded-full flex items-center justify-center text-xs font-bold flex-shrink-0">2</div>
                            <div class="text-sm text-gray-700">
                                <span data-en="Share your User ID with us" data-ar="شارك معرف المستخدم معنا">شارك معرف المستخدم معنا</span>
                            </div>
                        </div>
                        <div class="flex items-start gap-2">
                            <div class="w-6 h-6 bg-blue-500 text-white rounded-full flex items-center justify-center text-xs font-bold flex-shrink-0">3</div>
                            <div class="text-sm text-gray-700">
                                <span data-en="Transfer to: 96041234 (Bank Muscat)" data-ar="حوّل إلى: 96041234 (بنك مسقط)">حوّل إلى: 96041234 (بنك مسقط)</span>
                            </div>
                        </div>
                        <div class="flex items-start gap-2">
                            <div class="w-6 h-6 bg-blue-500 text-white rounded-full flex items-center justify-center text-xs font-bold flex-shrink-0">4</div>
                            <div class="text-sm text-gray-700">
                                <span data-en="Send receipt & get credits within 24h! ✅" data-ar="أرسل الإيصال لتحصل على الرصيد خلال ٢٤ ساعة ✅">أرسل الإيصال لتحصل على الرصيد خلال ٢٤ ساعة ✅</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- WhatsApp Button -->
                    <button onclick="openWhatsAppForPurchase()" class="w-full py-3 bg-gradient-to-r from-green-500 to-green-600 text-white font-bold rounded-xl hover:from-green-600 hover:to-green-700 transition-all transform hover:scale-105 shadow-lg mb-3">
                        <div class="flex items-center justify-center gap-2">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/>
                            </svg>
                            <span data-en="Open WhatsApp" data-ar="فتح واتساب">فتح واتساب</span>
                        </div>
                    </button>
                    
                    <!-- Back Button -->
                    <button onclick="goBackToPackages()" class="w-full py-2 text-gray-600 hover:text-gray-800 transition-colors text-sm">
                        <span data-en="← Back to Packages" data-ar="← العودة للباقات">← العودة للباقات</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Enhanced OmaniAI class with new features
        class OmaniAI {
            constructor() {
                this.currentLanguage = 'ar';
                this.isAuthenticated = false;
                this.userCredits = 0;
                this.clerk = null;
                this.currentUser = null;
                this.savedPrompt = '';
                this.init();
            }

            async init() {
                console.log('🚀 Initializing Modern Omani AI Generator...');
                
                // Create browser session ID for non-authenticated users
                this.createBrowserSession();
                
                await this.initializeClerk();
                this.setupEventListeners();
                this.updateLanguage();
                
                console.log('✅ Modern app initialized successfully');
            }

            createBrowserSession() {
                // Create a persistent browser session ID
                if (!localStorage.getItem('heiba-session-id')) {
                    const sessionId = 'session-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
                    localStorage.setItem('heiba-session-id', sessionId);
                    localStorage.setItem('heiba-session-created', new Date().toISOString());
                }
                
                // Store basic session info
                window.heibaSession = {
                    id: localStorage.getItem('heiba-session-id'),
                    created: localStorage.getItem('heiba-session-created'),
                    userAgent: navigator.userAgent.substr(0, 50), // First 50 chars
                    timestamp: Date.now()
                };
                
                console.log('Browser session created:', window.heibaSession.id);
            }

            async initializeClerk() {
                try {
                    while (!window.Clerk) {
                        await new Promise(resolve => setTimeout(resolve, 100));
                    }
                    
                    this.clerk = window.Clerk;
                    await this.clerk.load();
                    
                    const session = this.clerk.session;
                    this.isAuthenticated = !!session;
                    
                    // Show loading state first
                    this.showCreditsLoading();
                    
                    // Store user info globally for easier access
                    if (this.isAuthenticated && this.clerk.user) {
                        this.currentUser = this.clerk.user;
                        window.heibaUser = {
                            id: this.clerk.user.id || this.clerk.user.externalId,
                            email: this.clerk.user.primaryEmailAddress?.emailAddress || 
                                   this.clerk.user.emailAddresses?.[0]?.emailAddress,
                            name: this.clerk.user.fullName || this.clerk.user.firstName
                        };
                        console.log('User authenticated:', window.heibaUser);
                        
                        // Load credits BEFORE updating UI
                        await this.loadUserCredits();
                        await this.loadUserHistory();
                    }
                    
                    this.updateAuthUI(this.isAuthenticated);
                    
                    this.clerk.addListener(async ({ session }) => {
                        const wasAuthenticated = this.isAuthenticated;
                        this.isAuthenticated = !!session;
                        
                        // Update global user info
                        if (this.isAuthenticated && this.clerk.user) {
                            this.currentUser = this.clerk.user;
                            window.heibaUser = {
                                id: this.clerk.user.id || this.clerk.user.externalId,
                                email: this.clerk.user.primaryEmailAddress?.emailAddress || 
                                       this.clerk.user.emailAddresses?.[0]?.emailAddress,
                                name: this.clerk.user.fullName || this.clerk.user.firstName
                            };
                            console.log('User updated:', window.heibaUser);
                        } else {
                            this.currentUser = null;
                            window.heibaUser = null;
                        }
                        
                        if (this.isAuthenticated !== wasAuthenticated) {
                            this.updateAuthUI(this.isAuthenticated);
                            if (this.isAuthenticated) {
                                this.showCreditsLoading();
                                await this.loadUserCredits();
                                await this.loadUserHistory();
                                // Restore saved prompt if exists
                                if (this.savedPrompt) {
                                    document.getElementById('description').value = this.savedPrompt;
                                    this.savedPrompt = '';
                                }
                            } else {
                                this.userCredits = 0;
                                this.updateCreditsDisplay();
                            }
                        }
                    });
                    
                } catch (error) {
                    console.error('Failed to initialize Clerk:', error);
                    this.userCredits = 0;
                    this.updateCreditsDisplay();
                }
            }

            setupEventListeners() {
                // Language toggle
                document.getElementById('languageToggle')?.addEventListener('click', () => {
                    this.toggleLanguage();
                });

                // Auth button
                document.getElementById('authButton')?.addEventListener('click', () => {
                    this.handleAuth();
                });

                // Generate button
                document.getElementById('generateButton')?.addEventListener('click', () => {
                    this.handleGenerate();
                });

                // View samples scroll
                document.getElementById('viewSamplesButton')?.addEventListener('click', () => {
                    document.getElementById('samplesSection').scrollIntoView({ behavior: 'smooth' });
                });

                // History button
                document.getElementById('historyButton')?.addEventListener('click', () => {
                    this.openHistoryModal();
                });

                // Close history modal
                document.getElementById('closeHistoryModal')?.addEventListener('click', () => {
                    this.closeHistoryModal();
                });

                // Hide refined prompt
                document.getElementById('hideRefinedPrompt')?.addEventListener('click', () => {
                    this.hideRefinedPrompt();
                });

                // Download image
                document.getElementById('downloadImage')?.addEventListener('click', () => {
                    this.downloadImage();
                });
            }

            toggleLanguage() {
                this.currentLanguage = this.currentLanguage === 'en' ? 'ar' : 'en';
                this.updateLanguage();
            }

            updateLanguage() {
                const html = document.documentElement;
                const languageText = document.getElementById('languageText');
                const description = document.getElementById('description');

                if (this.currentLanguage === 'ar') {
                    html.setAttribute('dir', 'rtl');
                    html.setAttribute('lang', 'ar');
                    html.classList.add('font-arabic');
                    html.classList.remove('font-english');
                    if (languageText) languageText.textContent = 'English';
                    
                    if (description) {
                        description.placeholder = description.getAttribute('data-placeholder-ar');
                    }
                } else {
                    html.setAttribute('dir', 'ltr');
                    html.setAttribute('lang', 'en');
                    html.classList.add('font-english');
                    html.classList.remove('font-arabic');
                    if (languageText) languageText.textContent = 'عربي';
                    
                    if (description) {
                        description.placeholder = description.getAttribute('data-placeholder-en');
                    }
                }

                document.querySelectorAll('[data-en][data-ar]').forEach(element => {
                    const text = this.currentLanguage === 'ar' 
                        ? element.getAttribute('data-ar')
                        : element.getAttribute('data-en');
                    element.textContent = text;
                });

                // Update developer modal language
                const modal = document.getElementById('developerModal');
                if (modal && !modal.classList.contains('hidden')) {
                    const arabicContent = modal.querySelector('.ar-content');
                    const englishContent = modal.querySelector('.en-content');
                    
                    if (this.currentLanguage === 'ar') {
                        arabicContent.classList.remove('hidden');
                        englishContent.classList.add('hidden');
                    } else {
                        arabicContent.classList.add('hidden');
                        englishContent.classList.remove('hidden');
                    }
                }

                console.log(`🌐 Language updated to: ${this.currentLanguage}`);
            }

            // Authentication methods
            handleAuth() {
                if (this.isAuthenticated) {
                    this.signOut();
                } else {
                    this.signIn();
                }
            }

            async signIn() {
                try {
                    if (this.clerk) {
                        await this.clerk.openSignIn();
                    }
                } catch (error) {
                    console.error('Sign in failed:', error);
                    this.showMessage('Sign in failed', 'error');
                }
            }

            async signOut() {
                try {
                    if (this.clerk) {
                        await this.clerk.signOut();
                        this.showMessage(
                            this.currentLanguage === 'ar' ? 'تم تسجيل الخروج بنجاح' : 'Signed out successfully', 
                            'success'
                        );
                    }
                } catch (error) {
                    console.error('Sign out failed:', error);
                    this.showMessage(
                        this.currentLanguage === 'ar' ? 'فشل تسجيل الخروج' : 'Sign out failed', 
                        'error'
                    );
                }
            }

            updateAuthUI(authenticated) {
                const authButton = document.getElementById('authButton');
                const creditsDisplay = document.getElementById('creditsDisplay');

                if (authenticated) {
                    authButton.innerHTML = this.currentLanguage === 'ar' 
                        ? 'تسجيل الخروج' 
                        : 'Sign Out';
                    creditsDisplay?.classList.remove('hidden');
                } else {
                    authButton.innerHTML = this.currentLanguage === 'ar' 
                        ? 'تسجيل الدخول' 
                        : 'Sign In';
                    creditsDisplay?.classList.add('hidden');
                }
            }

            // Show loading state for credits
            showCreditsLoading() {
                const creditsCount = document.getElementById('creditsCount');
                const creditsDisplay = document.getElementById('creditsDisplay');
                if (creditsCount && creditsDisplay) {
                    creditsCount.textContent = '...';
                    creditsDisplay.style.opacity = '0.6';
                }
            }

            // Credits management
            async loadUserCredits() {
                if (!this.currentUser?.id && !window.heibaUser?.id) {
                    console.log('No user ID available for credit fetch');
                    this.userCredits = 0;
                    this.updateCreditsDisplay();
                    return;
                }

                try {
                    const response = await fetch('/api/credits', {
                        headers: {
                            'Authorization': `Bearer ${await this.clerk?.session?.getToken()}`,
                        }
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        this.userCredits = data.credits || 0;
                        console.log('Credits loaded successfully:', this.userCredits);
                    } else {
                        console.error('Failed to fetch credits:', response.status);
                        this.userCredits = 0;
                    }
                } catch (error) {
                    console.error('Error fetching credits:', error);
                    this.userCredits = 0;
                }
                
                // Always update display after fetch (success or failure)
                this.updateCreditsDisplay();
            }

            updateCreditsDisplay() {
                const creditsCount = document.getElementById('creditsCount');
                const creditsDisplay = document.getElementById('creditsDisplay');
                if (creditsCount && creditsDisplay) {
                    creditsCount.textContent = this.userCredits.toString();
                    creditsDisplay.style.opacity = '1'; // Remove loading opacity
                    
                    // Add glow effect if low credits
                    if (this.userCredits <= 3) {
                        creditsDisplay.classList.add('low-credits-glow');
                    } else {
                        creditsDisplay.classList.remove('low-credits-glow');
                    }
                }
                
                window.userCredits = this.userCredits; // Keep global sync
            }

            // Image generation
            async handleGenerate() {
                if (!this.isAuthenticated) {
                    // Save prompt for after login
                    this.savedPrompt = document.getElementById('description').value;
                    
                    this.showMessage(
                        this.currentLanguage === 'ar' 
                            ? 'يرجى تسجيل الدخول أولاً' 
                            : 'Please sign in first',
                        'warning'
                    );
                    await this.signIn();
                    return;
                }

                if (this.userCredits <= 0) {
                    this.showMessage(
                        this.currentLanguage === 'ar' 
                            ? 'رصيدك منتهي! يرجى شراء رصيد جديد' 
                            : 'No credits remaining! Please buy credits',
                        'warning'
                    );
                    setTimeout(() => showCreditModal(), 500);
                    return;
                }

                const description = document.getElementById('description').value.trim();
                if (!description) {
                    this.showMessage(
                        this.currentLanguage === 'ar' 
                            ? 'يرجى إدخال وصف للأزياء' 
                            : 'Please enter a description',
                        'warning'
                    );
                    return;
                }

                const prompt = description;

                // Collect advanced options
                let options = { ...advancedOptions };
                if (options.aspectRatio === 'custom') {
                    options.customWidth = advancedOptions.customWidth || 512;
                    options.customHeight = advancedOptions.customHeight || 512;
                }

                this.showGenerationStatus(true);
                this.hideRefinedPrompt();
                this.hideImageResult();

                try {
                    // 1. First, check for notifications immediately
                    // Get session token for API calls
                    const token = this.clerk?.session ? await this.clerk.session.getToken() : null;
                    
                    const notificationPromise = fetch('/api/notifications', {
                        method: 'POST',
                        headers: { 
                            'Content-Type': 'application/json',
                            ...(token && { 'Authorization': `Bearer ${token}` })
                        },
                        body: JSON.stringify({ prompt })
                    }).then(async (response) => {
                        if (response.ok) {
                            const data = await response.json();
                            if (data.notification) {
                                // Show notification immediately while image is generating
                                this.showSoftNotification(data.notification);
                            }
                        }
                    }).catch(error => {
                        console.warn('Notification check failed:', error);
                    });

                    // 2. Start image generation (this will take longer)
                    const generatePromise = fetch('/api/generate', {
                        method: 'POST',
                        headers: { 
                            'Content-Type': 'application/json',
                            ...(token && { 'Authorization': `Bearer ${token}` })
                        },
                        body: JSON.stringify({ prompt, options })
                    });

                    // Execute notification check immediately
                    notificationPromise;

                    // Wait for image generation
                    const response = await generatePromise;
                    const data = await response.json();

                    if (response.ok) {
                        // Show refined prompt
                        this.showRefinedPrompt(data.enhancedPrompt);
                        
                        // Show generated image
                        this.showImageResult(data.imageUrl);
                        
                        // Update credits
                        this.userCredits = data.remainingCredits;
                        this.updateCreditsDisplay();
                        
                        // Check for low credits and show alert
                        if (this.userCredits <= 5 && this.userCredits > 0) {
                            setTimeout(() => {
                                showLowCreditAlert();
                            }, 2000); // Show alert 2 seconds after successful generation
                        }
                        
                        // Reload history
                        await this.loadUserHistory();
                        
                        this.showMessage(
                            this.currentLanguage === 'ar' 
                                ? 'تم إنشاء الصورة بنجاح!' 
                                : 'Image generated successfully!',
                            'success'
                        );
                    } else {
                        throw new Error(data.error || 'Generation failed');
                    }
                } catch (error) {
                    console.error('Generation error:', error);
                    this.showMessage(
                        this.currentLanguage === 'ar' 
                            ? 'فشل في إنشاء الصورة' 
                            : 'Failed to generate image',
                        'error'
                    );
                } finally {
                    this.showGenerationStatus(false);
                }
            }

            showRefinedPrompt(prompt) {
                const container = document.getElementById('refinedPrompt');
                const text = document.getElementById('refinedPromptText');
                
                if (container && text) {
                    text.textContent = prompt;
                    container.classList.add('show');
                }
            }

            hideRefinedPrompt() {
                const container = document.getElementById('refinedPrompt');
                if (container) {
                    container.classList.remove('show');
                }
            }

            showImageResult(imageUrl) {
                const container = document.getElementById('imageResult');
                const image = document.getElementById('generatedImage');
                
                if (container && image) {
                    image.src = imageUrl;
                    container.classList.remove('hidden');
                }
            }

            hideImageResult() {
                const container = document.getElementById('imageResult');
                if (container) {
                    container.classList.add('hidden');
                }
            }

            showGenerationStatus(show) {
                const status = document.getElementById('generationStatus');
                if (status) {
                    if (show) {
                        status.classList.add('active');
                    } else {
                        status.classList.remove('active');
                    }
                }
            }

            // History management
            async loadUserHistory() {
                if (!this.isAuthenticated) return;

                try {
                    const response = await fetch('/api/history');
                    if (response.ok) {
                        const data = await response.json();
                        this.updateHistoryGrid(data.generations || []);
                    }
                } catch (error) {
                    console.error('Failed to load history:', error);
                }
            }

            updateHistoryGrid(generations) {
                const grid = document.getElementById('historyGrid');
                if (!grid) return;

                if (generations.length === 0) {
                    grid.innerHTML = `
                        <div class="text-center text-gray-500 col-span-full py-8" data-en="No generations yet. Create your first traditional clothing!" data-ar="لا توجد إبداعات بعد. أنشئ أول أزياءك التراثية!">
                            ${this.currentLanguage === 'ar' ? 'لا توجد إبداعات بعد. أنشئ أول أزياءك التراثية!' : 'No generations yet. Create your first traditional clothing!'}
                        </div>
                    `;
                    return;
                }

                grid.innerHTML = generations.map(gen => `
                    <div class="bg-white rounded-xl overflow-hidden shadow-lg hover:shadow-xl transition-all group">
                        <div class="aspect-square relative">
                            <img src="${gen.image_url}" alt="${gen.prompt}" class="w-full h-full object-cover">
                            
                            <!-- Action Buttons Overlay -->
                            <div class="absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-2">
                                <button 
                                    onclick="downloadHistoryImage('${gen.image_url}', '${gen.prompt.replace(/'/g, "\\'")}');" 
                                    class="p-2 bg-white/90 hover:bg-white rounded-full transition-colors" 
                                    title="${this.currentLanguage === 'ar' ? 'تحميل الصورة' : 'Download Image'}">
                                    <svg class="w-4 h-4 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                    </svg>
                                </button>
                                <button 
                                    onclick="copyPromptToClipboard('${gen.prompt.replace(/'/g, "\\'")}', '${gen.id}')" 
                                    class="p-2 bg-white/90 hover:bg-white rounded-full transition-colors" 
                                    title="${this.currentLanguage === 'ar' ? 'نسخ الوصف' : 'Copy Prompt'}">
                                    <svg class="w-4 h-4 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                                    </svg>
                                </button>
                                <button 
                                    onclick="deleteHistoryImage('${gen.id}')" 
                                    class="p-2 bg-red-500/90 hover:bg-red-500 rounded-full transition-colors" 
                                    title="${this.currentLanguage === 'ar' ? 'حذف الصورة' : 'Delete Image'}">
                                    <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        
                        <div class="p-3">
                            <p class="text-xs text-gray-600 truncate cursor-pointer hover:text-gray-800" onclick="copyPromptToClipboard('${gen.prompt.replace(/'/g, "\\'")}', '${gen.id}')" title="${this.currentLanguage === 'ar' ? 'اضغط لنسخ الوصف' : 'Click to copy prompt'}">${gen.prompt}</p>
                            <div class="flex items-center justify-between mt-2">
                                <p class="text-xs text-gray-400">${new Date(gen.created_at).toLocaleDateString()}</p>
                                <div class="flex gap-1">
                                    <button onclick="copyPromptToClipboard('${gen.prompt.replace(/'/g, "\\'")}', '${gen.id}')" class="text-xs text-blue-600 hover:text-blue-800 transition-colors">
                                        ${this.currentLanguage === 'ar' ? 'نسخ' : 'Copy'}
                                    </button>
                                    <span class="text-xs text-gray-300">•</span>
                                    <button onclick="downloadHistoryImage('${gen.image_url}', '${gen.prompt.replace(/'/g, "\\'")}');" class="text-xs text-green-600 hover:text-green-800 transition-colors">
                                        ${this.currentLanguage === 'ar' ? 'تحميل' : 'Download'}
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `).join('');
            }

            openHistoryModal() {
                if (!this.isAuthenticated) {
                    this.showMessage(
                        this.currentLanguage === 'ar' 
                            ? 'يرجى تسجيل الدخول لرؤية التاريخ' 
                            : 'Please sign in to view history',
                        'warning'
                    );
                    return;
                }

                const modal = document.getElementById('historyModal');
                if (modal) {
                    modal.classList.add('active');
                }
            }

            closeHistoryModal() {
                const modal = document.getElementById('historyModal');
                if (modal) {
                    modal.classList.remove('active');
                }
            }

            // Utility methods
            downloadImage() {
                const image = document.getElementById('generatedImage');
                const prompt = document.getElementById('description')?.value || 'omani_clothing';
                if (image && image.src) {
                    window.downloadImageByUrl(image.src, prompt);
                }
            }

            showMessage(message, type = 'info') {
                const container = document.getElementById('messageContainer');
                if (!container) return;

                const messageEl = document.createElement('div');
                const bgColor = {
                    success: 'bg-green-100 border-green-300 text-green-800',
                    error: 'bg-red-100 border-red-300 text-red-800',
                    warning: 'bg-amber-100 border-amber-300 text-amber-800',
                    info: 'bg-blue-100 border-blue-300 text-blue-800'
                };

                messageEl.className = `${bgColor[type]} px-4 py-3 rounded-xl border mb-2 transform translate-x-full transition-transform duration-300`;
                messageEl.innerHTML = `
                    <div class="flex items-center justify-between">
                        <span class="text-sm">${message}</span>
                        <button onclick="this.parentElement.parentElement.remove()" class="ml-2 text-current opacity-70 hover:opacity-100">✕</button>
                    </div>
                `;

                container.appendChild(messageEl);

                // Slide in
                setTimeout(() => {
                    messageEl.classList.remove('translate-x-full');
                }, 10);

                // Auto remove after 5 seconds
                setTimeout(() => {
                    if (messageEl.parentNode) {
                        messageEl.classList.add('translate-x-full');
                        setTimeout(() => messageEl.remove(), 300);
                    }
                }, 5000);
            }

            // Soft notification popup for AI feedback
            showSoftNotification(message) {
                const container = document.getElementById('aiMessagePlaceholder');
                if (!container) return;

                // Update content
                container.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3 rtl:space-x-reverse">
                            <div class="w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center">
                                <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                            </div>
                            <span class="text-blue-800 text-sm font-medium">${message}</span>
                        </div>
                        <button onclick="this.parentElement.parentElement.classList.add('hidden')" class="text-blue-400 hover:text-blue-600 transition-colors">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                `;

                // Show with animation
                container.classList.remove('hidden');
                container.style.transform = 'translateY(100%)';
                container.style.opacity = '0';
                
                setTimeout(() => {
                    container.style.transform = 'translateY(0)';
                    container.style.opacity = '1';
                    container.style.transition = 'all 0.3s ease-out';
                }, 10);

                // Auto hide after 8 seconds (longer for notifications)
                setTimeout(() => {
                    container.style.transform = 'translateY(100%)';
                    container.style.opacity = '0';
                    setTimeout(() => {
                        container.classList.add('hidden');
                    }, 300);
                }, 8000);
            }
        }

        // Advanced Options State
        const advancedOptions = {
            mode: 'quality', // 'quality' or 'fast'
            aspectRatio: '1:1',
            outputFormat: 'webp'
        };

        function toggleAdvancedOptions() {
            const panel = document.getElementById('advancedOptionsPanel');
            const chevron = document.getElementById('advancedOptionsChevron');
            
            if (panel.classList.contains('hidden')) {
                panel.classList.remove('hidden');
                chevron.style.transform = 'rotate(180deg)';
                
                // Smooth slide-in animation
                panel.style.opacity = '0';
                panel.style.transform = 'translateY(-10px)';
                setTimeout(() => {
                    panel.style.transition = 'all 0.3s ease-out';
                    panel.style.opacity = '1';
                    panel.style.transform = 'translateY(0)';
                }, 10);
            } else {
                panel.style.opacity = '0';
                panel.styletransform = 'translateY(-10px)';
                chevron.style.transform = 'rotate(0deg)';
                setTimeout(() => {
                    panel.classList.add('hidden');
                }, 300);
            }
        }

        function setGenerationMode(mode) {
            advancedOptions.mode = mode;
            
            const qualityBtn = document.getElementById('qualityMode');
            const fastBtn = document.getElementById('fastMode');
            
            if (mode === 'quality') {
                qualityBtn.className = 'px-3 py-2 bg-white border-2 border-indigo-500 text-indigo-600 rounded-lg text-xs font-medium transition-all hover:bg-indigo-50 flex items-center justify-center gap-1';
                fastBtn.className = 'px-3 py-2 bg-gray-100 border-2 border-gray-200 text-gray-600 rounded-lg text-xs font-medium transition-all hover:bg-gray-200 flex items-center justify-center gap-1';
            } else {
                qualityBtn.className = 'px-3 py-2 bg-gray-100 border-2 border-gray-200 text-gray-600 rounded-lg text-xs font-medium transition-all hover:bg-gray-200 flex items-center justify-center gap-1';
                fastBtn.className = 'px-3 py-2 bg-white border-2 border-indigo-500 text-indigo-600 rounded-lg text-xs font-medium transition-all hover:bg-indigo-50 flex items-center justify-center gap-1';
            }
            
            console.log('Generation mode set to:', mode);
        }

        function setAspectRatio(ratio) {
            advancedOptions.aspectRatio = ratio;
            // Hide/show custom inputs
            const customInputs = document.getElementById('customAspectInputs');
            if (ratio === 'custom') {
                customInputs.classList.remove('hidden');
            } else {
                customInputs.classList.add('hidden');
            }
            // Update all buttons
            document.querySelectorAll('.aspect-ratio-btn').forEach(btn => {
                btn.className = 'aspect-ratio-btn px-2 py-2 bg-gray-100 border-2 border-gray-200 text-gray-600 rounded-lg text-xs font-medium transition-all hover:bg-gray-200 flex flex-col items-center justify-center gap-1';
            });
            // Highlight selected
            event.target.closest('.aspect-ratio-btn').className = 'aspect-ratio-btn px-2 py-2 bg-white border-2 border-indigo-500 text-indigo-600 rounded-lg text-xs font-medium transition-all hover:bg-indigo-50 flex flex-col items-center justify-center gap-1';
            console.log('Aspect ratio set to:', ratio);
        }

        function applyCustomAspect() {
            const w = parseInt(document.getElementById('customWidth').value);
            const h = parseInt(document.getElementById('customHeight').value);
            if (isNaN(w) || isNaN(h) || w < 128 || h < 128 || w > 2048 || h > 2048) {
                alert('Please enter valid width and height (128-2048)');
                return;
            }
            advancedOptions.aspectRatio = 'custom';
            advancedOptions.customWidth = w;
            advancedOptions.customHeight = h;
            console.log('Custom aspect ratio applied:', w, 'x', h);
        }

        function setOutputFormat(format) {
            advancedOptions.outputFormat = format;
            
            // Update all buttons
            document.querySelectorAll('.output-format-btn').forEach(btn => {
                btn.className = 'output-format-btn px-3 py-2 bg-gray-100 border-2 border-gray-200 text-gray-600 rounded-lg text-xs font-medium transition-all hover:bg-gray-200';
            });
            
            // Highlight selected
            event.target.closest('.output-format-btn').className = 'output-format-btn px-3 py-2 bg-white border-2 border-indigo-500 text-indigo-600 rounded-lg text-xs font-medium transition-all hover:bg-indigo-50';
            
            console.log('Output format set to:', format);
        }

        // Developer modal functions
        function showDeveloperInfo() {
            const modal = document.getElementById('developerModal');
            const arabicContent = modal.querySelector('.ar-content');
            const englishContent = modal.querySelector('.en-content');
            
            // Show content based on current language
            const isArabic = document.documentElement.dir === 'rtl';
            if (isArabic) {
                arabicContent.classList.remove('hidden');
                englishContent.classList.add('hidden');
            } else {
                arabicContent.classList.add('hidden');
                englishContent.classList.remove('hidden');
            }
            
            modal.classList.remove('hidden');
            // Add animation
            setTimeout(() => {
                modal.querySelector('.bg-white').style.transform = 'scale(1)';
            }, 10);
        }

        function hideDeveloperInfo() {
            const modal = document.getElementById('developerModal');
            modal.querySelector('.bg-white').style.transform = 'scale(0.95)';
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 200);
        }

        // Close modal on backdrop click
        document.getElementById('developerModal').addEventListener('click', function(e) {
            if (e.target === this) {
                hideDeveloperInfo();
            }
        });

        // Credit Purchase Functions
        function showCreditModal() {
            const modal = document.getElementById('creditPurchaseModal');
            const arabicContent = modal.querySelector('.ar-content');
            const englishContent = modal.querySelector('.en-content');
            
            modal.classList.remove('hidden');
            // Add animation
            setTimeout(() => {
                modal.querySelector('.bg-white\\/95').style.transform = 'scale(1)';
            }, 10);
        }

        function closeCreditModal() {
            const modal = document.getElementById('creditPurchaseModal');
            modal.querySelector('.bg-white\\/95').style.transform = 'scale(0.95)';
            setTimeout(() => {
                modal.classList.add('hidden');
                // Reset to page 1 after closing
                setTimeout(() => {
                    const container = document.getElementById('modalContainer');
                    container.style.transform = 'translateX(0)';
                }, 200);
            }, 200);
        }

        function buyCredits(credits, omr) {
            // Store selected package info
            window.selectedPackage = { credits, omr };
            
            // Update page 2 with selected package info
            document.getElementById('selectedCredits').textContent = `${credits} Credits`;
            document.getElementById('selectedPrice').innerHTML = `${omr} <span data-en="OMR" data-ar="ريال">ريال</span>`;
            
            // Get and display user ID
            let userId = getUserId();
            document.getElementById('userIdDisplay').value = userId;
            
            // Swipe to page 2
            const container = document.getElementById('modalContainer');
            container.style.transform = 'translateX(-100%)';
        }
        
        function getUserId() {
            // Try multiple ways to get user information
            let userId = 'unknown-user';
            
            // Method 1: Try global heibaUser (authenticated user)
            if (window.heibaUser) {
                userId = window.heibaUser.id || userId;
            }
            
            // Method 2: Try window.app.clerk
            if (userId === 'unknown-user' && window.app?.clerk?.user) {
                userId = window.app.clerk.user.id || window.app.clerk.user.externalId || userId;
            }
            
            // Method 3: Try direct Clerk access
            if (userId === 'unknown-user' && window.Clerk?.user) {
                userId = window.Clerk.user.id || window.Clerk.user.externalId || userId;
            }
            
            // Method 4: Use browser session ID as fallback
            if (userId === 'unknown-user' && window.heibaSession) {
                userId = window.heibaSession.id;
            }
            
            // Method 5: Generate a browser-based ID if still unknown (last resort)
            if (userId === 'unknown-user') {
                let browserId = localStorage.getItem('heiba-browser-id');
                if (!browserId) {
                    browserId = 'browser-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
                    localStorage.setItem('heiba-browser-id', browserId);
                }
                userId = browserId;
            }
            
            return userId;
        }
        
        function copyUserId() {
            const userIdInput = document.getElementById('userIdDisplay');
            userIdInput.select();
            document.execCommand('copy');
            
            // Show feedback
            const button = event.target.closest('button');
            const originalText = button.innerHTML;
            button.innerHTML = '<span data-en="Copied!" data-ar="تم النسخ!">تم النسخ!</span>';
            setTimeout(() => {
                button.innerHTML = originalText;
            }, 2000);
        }
        
        function openWhatsAppForPurchase() {
            const userId = document.getElementById('userIdDisplay').value;
            const { credits, omr } = window.selectedPackage || { credits: 50, omr: 4 };
            const isArabic = document.documentElement.dir === 'rtl';
            
            // Create WhatsApp message based on language
            let message;
            if (isArabic) {
                message = `السلام عليكم! أريد شراء رصيد لتطبيق هيبة للذكاء الاصطناعي%0A%0Aالمبلغ: ${omr} ريال عماني (${credits} رصيد)%0Aمعرف المستخدم: ${userId}%0A%0Aسأحول إلى:%0A96041234 - Bank Muscat%0AAL MAALA AL MAAWALI%0A%0Aسأشارك إيصال التحويل معك بعد الدفع%0A%0Aشكراً لك!`;
            } else {
                message = `Hello! I'd like to buy credits for Heiba AI%0A%0AAmount: ${omr} OMR (${credits} credits)%0AUser ID: ${userId}%0A%0AI will transfer to:%0A96041234 - Bank Muscat%0AAL MAALA AL MAAWALI%0A%0AI'll share the transfer receipt with you after payment%0A%0AThank you!`;
            }
            
            // Bulletproof WhatsApp opener
            const phoneNumber = '96896041234';
            
            // Detect platform
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            
            if (isMobile) {
                // Mobile: Use wa.me (opens app directly)
                window.location.href = `https://wa.me/${phoneNumber}?text=${message}`;
            } else {
                // Desktop: Use WhatsApp Web (works for both web and desktop app)
                const whatsappUrl = `https://web.whatsapp.com/send?phone=${phoneNumber}&text=${message}`;
                
                // Create temporary link and click it
                const link = document.createElement('a');
                link.href = whatsappUrl;
                link.target = '_blank';
                link.rel = 'noopener noreferrer';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
            
            // Show confirmation message
            if (window.app) {
                window.app.showMessage(
                    isArabic 
                        ? 'تم فتح واتساب! أكمل التحويل وشارك الإيصال' 
                        : 'WhatsApp opened! Complete transfer and share receipt',
                    'success'
                );
            }
        }
        
        function goBackToPackages() {
            const container = document.getElementById('modalContainer');
            container.style.transform = 'translateX(0)';
        }

        function buyCreditsCustom() {
            const customAmount = parseFloat(document.getElementById('customAmount').value);
            if (customAmount && customAmount >= 0.5 && customAmount <= 100) {
                const credits = Math.floor(customAmount * 10);
                buyCredits(credits, customAmount);
            } else {
                if (window.app) {
                    const isArabic = document.documentElement.dir === 'rtl';
                    window.app.showMessage(
                        isArabic 
                            ? 'يرجى إدخال مبلغ صحيح (0.5-100 ريال)' 
                            : 'Please enter a valid amount (0.5-100 OMR)',
                        'warning'
                    );
                }
            }
        }

        function showCreditModal() {
            const modal = document.getElementById('creditPurchaseModal');
            const isArabic = document.documentElement.dir === 'rtl';
            
            // Update modal content based on language
            modal.classList.remove('hidden');
            
            // Add animation
            setTimeout(() => {
                modal.querySelector('.bg-white\\/95').style.transform = 'scale(1)';
            }, 10);
        }

        // Smart credit alerts
        function checkCreditsAndNotify() {
            if (window.app && window.app.userCredits <= 0) {
                showCreditModal();
            } else if (window.app && window.app.userCredits <= 3) {
                showLowCreditAlert();
            }
        }

        function showLowCreditAlert() {
            // Gentle orange glow on credit counter
            const creditsDisplay = document.getElementById('creditsDisplay');
            if (creditsDisplay) {
                creditsDisplay.classList.add('low-credits-glow');
                
                // Remove glow after 5 seconds
                setTimeout(() => {
                    creditsDisplay.classList.remove('low-credits-glow');
                }, 5000);
            }
        }

        // Smart credit alerts
        function checkCreditsAndNotify() {
            const userCredits = window.app?.userCredits || 0;
            
            if (userCredits <= 0) {
                setTimeout(() => showCreditModal(), 1000);
            } else if (userCredits <= 3) {
                showLowCreditAlert();
            }
        }

        // Close credit modal on backdrop click
        document.getElementById('creditPurchaseModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeCreditModal();
            }
        });

        // Prompt Suggestion Functions
        function showSuggestionPopup() {
            const modal = document.getElementById('suggestionModal');
            modal.classList.remove('hidden');
            
            // Add animation
            setTimeout(() => {
                const modalContent = modal.querySelector('.bg-white\\/95');
                if (modalContent) {
                    modalContent.style.transform = 'scale(1)';
                }
            }, 10);
        }

        function closeSuggestionModal() {
            const modal = document.getElementById('suggestionModal');
            const modalContent = modal.querySelector('.bg-white\\/95');
            if (modalContent) {
                modalContent.style.transform = 'scale(0.95)';
            }
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 200);
        }

        function useSuggestedPrompt() {
            const promptText = "محارب عُماني يحمل ندوب المعارك، ملطخ بالتراب والعرق، يلوّح بالأسلحة العُمانية التقليدية في مشهد درامي مليء بالحركة، تتناثر فيه الشرر والدخان، مع إضاءة ملحمية.";
            const descriptionTextarea = document.getElementById('description');
            
            if (descriptionTextarea) {
                descriptionTextarea.value = promptText;
                descriptionTextarea.focus();
                
                // Add a subtle highlight animation
                descriptionTextarea.style.borderColor = '#f59e0b';
                descriptionTextarea.style.boxShadow = '0 0 0 3px rgba(245, 158, 11, 0.1)';
                
                setTimeout(() => {
                    descriptionTextarea.style.borderColor = '';
                    descriptionTextarea.style.boxShadow = '';
                }, 2000);
            }
            
            closeSuggestionModal();
            
            // Show success message
            if (window.app) {
                window.app.showMessage(
                    document.documentElement.dir === 'rtl' 
                        ? 'تم إدراج الاقتراح! يمكنك التعديل عليه أو الإنشاء مباشرة' 
                        : 'Suggestion added! You can modify it or generate directly',
                    'success'
                );
            }
        }

        // Close suggestion modal on backdrop click
        document.getElementById('suggestionModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeSuggestionModal();
            }
        });

        // History Management Functions
        function copyPromptToClipboard(prompt, imageId) {
            navigator.clipboard.writeText(prompt).then(() => {
                // Show success feedback
                if (window.app) {
                    const isArabic = document.documentElement.dir === 'rtl';
                    window.app.showMessage(
                        isArabic ? 'تم نسخ الوصف إلى الحافظة!' : 'Prompt copied to clipboard!',
                        'success'
                    );
                }
                
                // Visual feedback - highlight the copied item briefly
                const gridItem = document.querySelector(`[onclick*="${imageId}"]`)?.closest('.group');
                if (gridItem) {
                    gridItem.style.transform = 'scale(1.02)';
                    gridItem.style.boxShadow = '0 0 20px rgba(59, 130, 246, 0.3)';
                    setTimeout(() => {
                        gridItem.style.transform = '';
                        gridItem.style.boxShadow = '';
                    }, 500);
                }
            }).catch(err => {
                console.error('Failed to copy prompt:', err);
                if (window.app) {
                    const isArabic = document.documentElement.dir === 'rtl';
                    window.app.showMessage(
                        isArabic ? 'فشل في نسخ الوصف' : 'Failed to copy prompt',
                        'error'
                    );
                }
            });
        }

        function downloadHistoryImage(imageUrl, prompt) {
            try {
                // Use the global download function
                window.downloadImageByUrl(imageUrl, prompt);
                
                // Show success message
                if (window.app) {
                    const isArabic = document.documentElement.dir === 'rtl';
                    window.app.showMessage(
                        isArabic ? 'بدأ تحميل الصورة!' : 'Image download started!',
                        'success'
                    );
                }
            } catch (error) {
                console.error('Failed to download image:', error);
                if (window.app) {
                    const isArabic = document.documentElement.dir === 'rtl';
                    window.app.showMessage(
                        isArabic ? 'فشل في تحميل الصورة' : 'Failed to download image',
                        'error'
                    );
                }
            }
        }

        async function deleteHistoryImage(imageId) {
            const isArabic = document.documentElement.dir === 'rtl';
            
            // Confirm deletion
            const confirmMessage = isArabic 
                ? 'هل أنت متأكد من حذف هذه الصورة؟ لا يمكن التراجع عن هذا الإجراء.'
                : 'Are you sure you want to delete this image? This action cannot be undone.';
                
            if (!confirm(confirmMessage)) {
                return;
            }
            
            try {
                const response = await fetch(`/api/history/${imageId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${window.app?.clerk?.session?.getToken()}`,
                    }
                });
                
                if (response.ok) {
                    // Remove from UI immediately
                    const gridItem = document.querySelector(`[onclick*="${imageId}"]`)?.closest('.group');
                    if (gridItem) {
                        gridItem.style.transform = 'scale(0.8)';
                        gridItem.style.opacity = '0';
                        setTimeout(() => {
                            gridItem.remove();
                        }, 300);
                    }
                    
                    // Show success message
                    if (window.app) {
                        window.app.showMessage(
                            isArabic ? 'تم حذف الصورة بنجاح' : 'Image deleted successfully',
                            'success'
                        );
                    }
                    
                    // Reload history after a delay to sync with server
                    setTimeout(() => {
                        if (window.app) {
                            window.app.loadUserHistory();
                        }
                    }, 1000);
                } else {
                    throw new Error('Failed to delete image');
                }
            } catch (error) {
                console.error('Failed to delete image:', error);
                if (window.app) {
                    window.app.showMessage(
                        isArabic ? 'فشل في حذف الصورة' : 'Failed to delete image',
                        'error'
                    );
                }
            }
        }

        // Global image download function
        window.downloadImageByUrl = async function(url, prompt) {
            try {
                // Get extension from URL
                let ext = 'webp';
                const match = url.match(/\.([a-zA-Z0-9]+)(\?|$)/);
                if (match) ext = match[1];
                // Clean prompt for filename
                let name = prompt ? prompt.replace(/[^a-zA-Z0-9\u0600-\u06FF]+/g, '_').slice(0, 40) : 'omani_clothing';
                let filename = `${name}_${Date.now()}.${ext}`;
                // Fetch image as blob
                const response = await fetch(url);
                const blob = await response.blob();
                // Create download link
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = filename;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                setTimeout(() => URL.revokeObjectURL(link.href), 1000);
            } catch (err) {
                alert('Failed to download image');
            }
        }

        // Initialize the app
        const app = new OmaniAI();
        window.app = app;
    </script>
</body>
</html>
